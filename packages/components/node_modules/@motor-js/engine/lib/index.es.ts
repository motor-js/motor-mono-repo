import e,{useContext as r,useState as t,useEffect as n,useRef as o,useReducer as i,useCallback as u}from"react";import s from"react-watermark-component";import a from"prop-types";import{jsx as c,jsxs as l}from"react/jsx-runtime";import q from"crypto-js/aes";import f from"crypto-js/enc-utf8";var d=e.createContext();function p(){return(p=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function h(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r.indexOf(t=i[n])>=0||(o[t]=e[t]);return o}var m,y=function(e){var r=e.config,t=e.header,n=e.body,o=e.bodySub,i=e.buttonText,u=e.buttonFontColor,s=e.buttonColor,a=e.logo,q=e.loginfontFamily,f=r.host,d=r.webIntId;return c("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:l("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[c("div",{style:{fontFamily:q,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:c("div",{size:e.size,style:{padding:"0.6rem",fontSize:"18px"},children:a?c("img",{src:a,height:e.logoHeight,width:e.logoWidth,alt:"Logo"}):t})}),l("div",{style:{fontFamily:q,width:"100%",display:"flex",boxSizing:"border-box",padding:"0.8rem",WebkitAlignItems:"center",WebkitBoxAlign:"center",msFlexAlign:"center",alignItems:"center",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"column",msFlexDirection:"column",flexDirection:"column",WebkitFlex:"column",msFlex:"0 0 auto",flex:"0 0 auto"},children:[c("div",{style:{padding:"0.6rem",fontSize:"14px"},children:n}),c("div",{style:{padding:"0.6rem",fontSize:"14px"},children:o}),c("button",{style:{fontFamily:q,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:s,borderRadius:"8px",color:u,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){var e=new URL("https://"+f+"/login");e.searchParams.append("returnto",window.location.href),e.searchParams.append("qlik-web-integration-id",d),window.location.href=e},children:i})]})]})})},b=["config"],v=function(e){var t=e.config,n=h(e,b),o=r(d).errorCode;return c("div",{style:{display:-1===o?"":"none"},children:t&&o&&c(y,p({config:t},n))})};v.propTypes=((m={config:a.object,header:a.string,body:a.string,bodySub:a.string,size:a.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:a.string,backgroundColor:a.string,buttonFontColor:a.string,buttonColor:a.string,logo:a.string,logoHeight:a.string,logoWidth:a.string}).header=a.string,m.loginfontFamily=a.string,m),v.defaultProps={config:null,logo:null,logoHeight:null,logoWidth:null,header:"Welcome to your motor js mashup",body:"Please log on to access your application",bodySub:"",size:"medium",buttonText:"Login",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var g=function(e){var r=e.body,t=e.size,n=e.buttonText,o=e.buttonFontColor,i=e.buttonColor,u=e.loginfontFamily;return c("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:l("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[c("div",{style:{fontFamily:u,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:c("div",{size:t,style:{padding:"0.8rem",fontSize:"16px"},children:e.header})}),l("div",{focusable:!1,width:"100%",align:"center",direction:"column",padding:"0.8rem",children:[c("div",{size:t,style:{padding:"0.6rem",fontSize:"14px",fontFamily:u},children:r}),c("button",{style:{fontFamily:u,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:i,borderRadius:"8px",color:o,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){return location.reload()},children:n})]})]})})},S=require("enigma.js"),C=require("enigma.js/schemas/12.170.2.json"),P=require("enigma.js/sense-utilities");function D(e){var r=[{onRejected:function(e,r,t){return console.warn("Captured Request: Rejected","Error Code: "+t.code+" : "+t),t.code===C.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(r.tries=(r.tries||0)+1,console.warn("Captured Request: Retry #"+r.tries),r.tries<=3)?r.retry():t.code===C.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||t.code===C.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?t.code:(console.warn(t),this.Promise.reject(t))}}],n=t(!1),o=n[0],i=n[1],u=t(null),s=u[0],a=u[1],c=t(function(){!function(){try{var t,n=function(n){return t?n:function(){if(e){var t=P.buildUrl(e);return function(n,o){try{var i=((u=S.create({schema:C,url:t,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),u.on("error",function(){console.warn("Captured session error")}),u.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(u.open()).then(function(r){return Promise.resolve(r.openDoc(e.appId)).then(function(e){return l(e),a(1),1})}))}catch(e){return o(e)}var u;return i&&i.then?i.then(void 0,o):i}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(e&&e.qcs){var n=e.host,o=e.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),t=1,-1;var s=S.create({schema:C,url:"wss://"+n+"/app/"+e.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(r){return Promise.resolve(r.openDoc(e.appId)).then(function(e){return l(e),a(1),t=1})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return{engine:c[0],engineError:o,errorCode:s}}var x=["config"],L=function(e){var t=e.config,n=h(e,x),o=r(d),i=D(t),u=(o||i).errorCode;return c("div",{style:{display:-3===u?"":"none"},children:t&&u&&c(g,p({},n))})};function I(e){var r=e.engine,o=e.children,i=e.licenseKey,u=e.logo,a=e.logoWidth,p=e.logoHeight,h=e.header,m=e.body,y=e.bodySub,b=e.size,g=e.buttonText,S=e.buttonFontColor,C=e.buttonColor,P=e.backgroundColor,x=e.loginfontFamily,I=e.NotConnectedheader,T=e.NotConnectedBody,O=e.NotConnectedButtonText,j=t(e.config)[0],k=t(!0),E=k[0],F=k[1],w=r?{engine:r,engineError:null,errorCode:null}:D(j),N=i?function(e){var r,t=[];for(r=1;r<101;r++)t.push("MotorLicense-"+r);var n=q.decrypt(e,"S@few/M0t0r").toString(f);return t.filter(function(e){return e==n})}(i):[];return n(function(){F(N.length>0)},[i]),l(d.Provider,{value:w,children:[c(v,{config:j,logo:u,logoHeight:p,logoWidth:a,header:h,body:m,bodySub:y,size:b,backgroundColor:P,buttonText:g,buttonFontColor:S,buttonColor:C,loginfontFamily:x}),c(L,{config:j,header:I,body:T,size:b,buttonText:O,backgroundColor:P,buttonFontColor:S,buttonColor:C,loginfontFamily:x}),E?c("div",{children:o}):c(s,{waterMarkText:"Powered by Motor",openSecurityDefense:!0,securityAlarm:function(){console.error("start alarm!")},options:{chunkWidth:200,chunkHeight:90,textAlign:"left",textBaseline:"bottom",globalAlpha:.27,font:"16px Roboto sans-serif",rotateAngle:-.19,fillStyle:"#666"},children:o})]})}L.propTypes={header:a.string,body:a.string,size:a.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:a.string,backgroundColor:a.string,buttonFontColor:a.string,buttonColor:a.string,loginfontFamily:a.string},L.defaultProps={header:"Connection to server lost",body:"Please reload the page to refresh the dashboard",size:"medium",buttonText:"Reload Page",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var T=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},O=function e(r){var t=[].slice.call(arguments,1);if(!t.length)return r;var n=p({},r);return t.forEach(function(r){T(r)&&Object.keys(r).forEach(function(t){n[t]=T(r[t])?n[t]?e(n[t],r[t]):p({},r[t]):r[t]})}),n},j={qData:null,qRData:null,qLayout:null,selections:null};function k(e,r){var t=r.payload,n=t.qData,o=t.qRData,i=t.qLayout,u=t.selections;switch(r.type){case"update":return p({},e,{qData:n,qLayout:i,selections:u});case"updateReducedData":return p({},e,{qRData:o});default:throw new Error}}var E={cols:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},F=function(e){var t,s=O(E,e),a=s.cols,c=s.qHyperCubeDef,l=s.qPage,q=s.qSortByAscii,f=s.qSortByLoadOrder,h=s.qInterColumnSortOrder,m=s.qSuppressZero,y=s.qSortByNumeric,b=s.qSortByExpression,v=s.qSuppressMissing,g=s.qExpression,S=s.qColumnOrder,C=s.qCalcCondition,P=s.getQRData,D=s.qOtherTotalSpec,x=o(!0),L=i(k,j),I=L[0],T=L[1],F=I.qData,w=I.qRData,N=I.qLayout,B=I.selections,A=(r(d)||{}).engine,H=o(null),R=o(l);"object"==typeof D?t={qOtherMode:"OTHER_COUNTED",qOtherCounted:D.qOtherCount}:D?t={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:D||(t={qOtherMode:"OTHER_OFF",qOtherCounted:""});var M=u(function(){var e={qInfo:{qType:"visualization"}};if(c){var r=c;return a&&a[1]&&(r.qMeasures[0].qDef={qDef:a[1]}),a&&a[0]&&(r.qDimensions[0].qDef.qFieldDefs=[a[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=r,e}var n=h||[],o=!!h,i=0,u=a.filter(function(e,r){var t="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return t&&!o&&(n[r]=i,i+=1),t}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:q,qSortByLoadOrder:f}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:t,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:f,qSortByAscii:q}]},qOtherTotalSpec:t,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),s=a.filter(function(e,r){var t="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return t&&!o&&(n[r]=i,i+=1),t}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:g,qSuppressMissing:v}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:g,qSuppressMissing:v},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return e.qHyperCubeDef={qDimensions:u,qMeasures:s,qInterColumnSortOrder:h,qSuppressZero:m,qSuppressMissing:v,qColumnOrder:S,qCalcCondition:C},e},[a,g,c,h,q,b,f,v,m]),W=u(function(){return H.current.getLayout()},[]),z=u(function(){try{return Promise.resolve(H.current.getHyperCubeData("/qHyperCubeDef",[R.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),V=u(function(){return function(){try{var e=R.current.qWidth,r={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(H.current.getHyperCubeReducedData("/qHyperCubeDef",[r],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),_=u(function(e){try{return Promise.resolve(W()).then(function(r){return Promise.resolve(z()).then(function(t){if(t&&x.current){var n=t.qMatrix.filter(function(e){return"S"===e[0].qState});e&&e.map(function(e,t){r.qHyperCube.qMeasureInfo[t]&&(r.qHyperCube.qMeasureInfo[t].qChartType=e.qChartType,r.qHyperCube.qMeasureInfo[t].qShowPoints=e.qShowPoints,r.qHyperCube.qMeasureInfo[t].qCurve=e.qCurve,r.qHyperCube.qMeasureInfo[t].qFillStyle=e.qFillStyle,r.qHyperCube.qMeasureInfo[t].qLegendShape=e.qLegendShape)}),T({type:"update",payload:{qData:t,qLayout:r,selections:n}})}else x.current&&T({type:"update",payload:{qData:t,qLayout:r}});var o=function(){if(P)return Promise.resolve(V()).then(function(e){x.current&&T({type:"updateReducedData",payload:{qRData:e}})})}();if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},[z,W,P,V]),K=u(function(e){R.current=p({},R.current,e),_()},[_]),U=u(function(){return H.current.beginSelections(["/qHyperCubeDef"])},[!0]),G=u(function(e){return H.current.endSelections(e)},[]),J=u(function(e,r,t){return void 0===t&&(t=!1),H.current.selectHyperCubeValues("/qHyperCubeDef",e,r,t)},[]),Z=u(function(e){return H.current.applyPatches(e)},[]);return n(function(){if(A&&!H.current)try{var e=M();return Promise.resolve(A).then(function(r){return Promise.resolve(r.createSessionObject(e)).then(function(r){H.current=r,H.current.on("changed",function(){_(e.qHyperCubeDef.qMeasures)}),_(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[M,A,_]),n(function(){return function(){return x.current=!1}},[]),{beginSelections:U,endSelections:G,qLayout:N,qData:F,qRData:w,changePage:K,selections:B,select:J,applyPatches:Z}},w={qDoc:null,qObject:null,qData:null,listData:null,selections:null,selectionsId:null};function N(e,r){var t=r.payload,n=t.qData,o=t.listData,i=t.selections,u=t.selectionsId,s=t.qDoc;switch(r.type){case"update":return p({},e,{qData:n,listData:o,selections:i,selectionsId:u});case"init":return p({},e,{qDoc:s});default:throw new Error}}var B={autoSortByState:1,qSortByAscii:1,qSortByLoadOrder:1,dimension:null,label:null,qListObjectDef:null,qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e4}},A=function(e){var t=O(B,e),s=t.qPage,a=t.dimension,c=t.qListObjectDef,l=t.qSortByAscii,q=t.qSortByLoadOrder,f=t.autoSortByState,h=(r(d)||{}).engine,m=o(!0),y=i(N,w),b=y[0],v=y[1],g=b.listData,S=b.selections,C=b.selectionsId,P=o(null),D=o(s),x=u(function(e){void 0===e&&(e=0);var r={qInfo:{qType:"visualization"}};if(c)r.qListObjectDef=c;else{var t=a.filter(function(e){return"string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByLoadOrder:q,qSortByAscii:l}]}}:e});r.qListObjectDef=p({},{qLibraryId:"object"==typeof a[0]&&a[0].qLibraryId?a[0].qLibraryId:""},t[e],{qShowAlternatives:!0,qAutoSortByState:{qDisplayNumberOfRows:f}})}return r},[f,a,c,l,q]),L=u(function(){try{return Promise.resolve(P.current.getListObjectData("/qListObjectDef",[D.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),I=u(function(e){try{if(!g){if(!e)return Promise.resolve(null);var r=[];e.qMatrix.map(function(e,t){r.push({key:e[0].qElemNumber,text:void 0!==e[0].qText?e[0].qText:"undefined",number:e[0].qNumber,state:e[0].qState,value:void 0!==e[0].qText?e[0].qText:"undefined",label:void 0!==e[0].qText?e[0].qText:"undefined"})});var t=r&&r.filter(function(e){return"S"===e.state}),n=t&&t.map(function(e){return e.key});return Promise.resolve({_selId:n,_selections:t,_listData:r})}return Promise.resolve()}catch(e){return Promise.reject(e)}},[g]),T=u(function(){try{return Promise.resolve(L()).then(function(e){return Promise.resolve(I(e)).then(function(r){var t=r._listData;e&&m.current?v({type:"update",payload:{listData:t,selections:r._selections,selectionsId:r._selId}}):m.current&&v({type:"update",payload:{listData:t}})})})}catch(e){return Promise.reject(e)}},[L,I]),j=u(function(e){D.current=p({},D.current,e),T()},[T]),k=u(function(e,r,t){return void 0===r&&(r=!0),void 0===t&&(t=!1),P.current.selectListObjectValues("/qListObjectDef",e,r,t)},[]),E=u(function(e){return P.current.searchListObjectFor("/qListObjectDef",e)},[]),F=u(function(e){return void 0===e&&(e=!1),P.current.acceptListObjectSearch("/qListObjectDef",!0,e)},[]),A=u(function(e){return P.current.applyPatches(e)},[]),H=u(function(){return P.current.clearSelections("/qListObjectDef")},[]);return n(function(){if(h&&!P.current)try{var e=x();return Promise.resolve(h).then(function(r){return Promise.resolve(r.createSessionObject(e)).then(function(e){P.current=e,m.current&&v({type:"init",payload:{qDoc:r}}),P.current.on("changed",function(){T()}),T()})})}catch(e){Promise.reject(e)}},[x,h,T]),n(function(){return function(){return m.current=!1}},[]),{listData:g,changePage:j,select:k,beginSelections:function(){try{return Promise.resolve(b.qDoc.abortModal(!0)).then(function(){return Promise.resolve(P.current.beginSelections(["/qListObjectDef"])).then(function(){})})}catch(e){return Promise.reject(e)}},endSelections:function(e){try{return Promise.resolve(P.current.endSelections(e)).then(function(){})}catch(e){return Promise.reject(e)}},searchListObjectFor:E,acceptListObjectSearch:F,applyPatches:A,selections:S,selectionsId:C,clearSelections:H,motorListProps:{clearSelections:H,selections:S,select:k}}},H=function(e){return e.qMeasureInfo.map(function(e,r){return e.qFallbackTitle})},R=function(e){return e.qDimensionInfo.map(function(e,r){return e.qFallbackTitle})},M=function(e){var r=e.qHyperCube||e.qListObject,t=r.qDimensionInfo,n=r.qMeasureInfo,o=function(){(Array.isArray(t)?t:[t]).forEach(function(e){e.qError&&console.error("There is an issue with your dimension. Please fix this in order to receive the correct data. ",e.qError)})},i=function(){n.forEach(function(e){isNaN(e.qMax)&&isNaN(e.qMin)&&console.error("There is an issue with your measure. It is not returning any data.")})};t&&n?(o(),i()):t&&!n?o():!t&&n&&i()};function W(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var z={qData:null,qRData:null,qLayout:null,selections:null};function V(e,r,t){if(!e.s){if(t instanceof _){if(!t.s)return void(t.o=V.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(V.bind(null,e,r),V.bind(null,e,2));e.s=r,e.v=t;var n=e.o;n&&n(e)}}var _=function(){function e(){}return e.prototype.then=function(r,t){var n=new e,o=this.s;if(o){var i=1&o?r:t;if(i){try{V(n,1,i(this.v))}catch(e){V(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?V(n,1,r?r(o):o):t?V(n,1,t(o)):V(n,2,o)}catch(e){V(n,2,e)}},n},e}();function K(e){return e instanceof _&&1&e.s}function U(e,r){var t=r.payload,n=t.title,o=t.subTitle,i=t.metrics,u=t.qData,s=t.mData,a=t.nameKey,c=t.valueKey,l=t.qListData,q=t.dataList,f=t.dataKeys,d=t.qRData,h=t.qLayout,m=t.selections;switch(r.type){case"update":return p({},e,{title:n,subTitle:o,metrics:i,qData:u,mData:s,nameKey:a,valueKey:c,qListData:l,dataList:q,dataKeys:f,qLayout:h,selections:m});case"updateReducedData":return p({},e,{qRData:d});default:throw new Error}}var G={cols:[],qLists:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qTitle:null,qSubTitle:null,qMetrics:null,qOtherTotalSpec:""},J=function(e){var s,a=O(G,e),c=a.cols,l=a.qLists,q=a.qTitle,f=a.qSubTitle,h=a.qMetrics,m=a.qHyperCubeDef,y=a.qPage,b=a.qSortByAscii,v=a.qSortByLoadOrder,g=a.qInterColumnSortOrder,S=a.qSuppressZero,C=a.qSortByNumeric,P=a.qSortByExpression,D=a.qSuppressMissing,x=a.qExpression,L=a.qColumnOrder,I=a.qCalcCondition,T=a.getQRData,j=a.qOtherTotalSpec,k=o(!0),E=i(U,z),F=E[0],w=E[1],N=F.title,B=F.subTitle,A=F.metrics,J=F.qData,Z=F.mData,Q=F.nameKey,X=F.valueKey,$=F.qListData,Y=F.dataList,ee=F.dataKeys,re=F.qRData,te=F.qLayout,ne=F.selections,oe=(r(d)||{}).engine,ie=o(null),ue=o(y),se=t()[1],ae=t(ue.current.qHeight)[0];"object"==typeof j?s={qOtherMode:"OTHER_COUNTED",qOtherCounted:j.qOtherCount}:j?s={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:j||(s={qOtherMode:"OTHER_OFF",qOtherCounted:""});var ce=u(function(){var e={qInfo:{qType:"visualization"}};if(h&&h.map(function(r){var t;e[r.qName]=((t={})[r.qType?r.qType:"qValueExpression"]={qExpr:r.qExpr},t)}),l&&(e.qListObjects=[],l.map(function(r){var t={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:[Object.values(r)[0]],qFieldLabels:[Object.keys(r)[0]],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};e.qListObjects.push(t)})),m){var r=m;return c&&c[1]&&(r.qMeasures[0].qDef={qDef:c[1]}),c&&c[0]&&(r.qDimensions[0].qDef.qFieldDefs=[c[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=r,e}var t=g||[],n=!!g,o=0,i=c&&c.filter(function(e,r){var i="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return i&&!n&&(t[r]=o,o+=1),i}).map(function(e){if("string"==typeof e)return{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:b,qSortByLoadOrder:v}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0};if("object"==typeof e&&!e.qLibraryId){var r=[];if(e.qAttributeExpressions)for(var t=0,n=Object.entries(e.qAttributeExpressions);t<n.length;t++){var o=n[t];r.push({id:o[0],qExpression:o[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:v,qSortByAscii:b}]},qOtherTotalSpec:s,qOtherLabel:void 0!==j?j.qOtherLabel:"Others",qAttributeExpressions:r,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}if("object"==typeof e&&e.qLibraryId){var i=[];if(e.qAttributeExpressions)for(var u=0,a=Object.entries(e.qAttributeExpressions);u<a.length;u++){var c=a[u];i.push({id:c[0],qExpression:c[1],qLibraryId:"",qAttribute:!1})}return{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:s,qOtherLabel:void 0!==j?j.qOtherLabel:"Others",qAttributeExpressions:i,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}return e});if(i&&i.length>1){var u={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:i[1].qDef.qFieldDefs,qFieldLabels:["multiDimDataKeys"],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};void 0===e.qListObjects&&(e.qListObjects=[]),e.qListObjects.push(u)}var a=c&&c.filter(function(e,r){var i="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return i&&!n&&(t[r]=o,o+=1),i}).map(function(e){if("string"==typeof e)return{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:C,qSortByExpression:P,qExpression:x,qSuppressMissing:D}};if("object"==typeof e){var r=[];if(e.qAttributeExpressions)for(var t=0,n=Object.entries(e.qAttributeExpressions);t<n.length;t++){var o=n[t];r.push({id:o[0],qExpression:o[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:C,qSortByExpression:P,qExpression:x,qSuppressMissing:D},qAttributeExpressions:r}}return e});return e.qHyperCubeDef={qDimensions:i,qMeasures:a,qInterColumnSortOrder:g,qSuppressZero:S,qSuppressMissing:D,qColumnOrder:L,qCalcCondition:I,qTitle:q},e},[c,q,x,m,g,b,P,v,D,S]),le=u(function(){return ie.current.getLayout()},[]),qe=u(function(){try{return Promise.resolve(W(function(){return Promise.resolve(ie.current.getHyperCubeData("/qHyperCubeDef",[ue.current])).then(function(e){return e[0]})},function(e){se(e)}))}catch(e){return Promise.reject(e)}},[]),fe=u(function(e){try{var r=ie.current,t=ue.current,n=null,o=[];return Promise.resolve(W(function(){function i(){return{qTails:n[0].qTails,qMatrix:o,qArea:n[0].qArea}}var u=0,s=function(e,r,t){for(var n;;){var o=e();if(K(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=t();if(i&&i.then){if(!K(i)){n=1;break}i=i.s}if(r){var u=r();if(u&&u.then&&!K(u)){n=2;break}}}var s=new _,a=V.bind(null,s,2);return(0===n?o.then(l):1===n?i.then(c):u.then(q)).then(void 0,a),s;function c(n){i=n;do{if(r&&(u=r())&&u.then&&!K(u))return void u.then(q).then(void 0,a);if(!(o=e())||K(o)&&!o.v)return void V(s,1,i);if(o.then)return void o.then(l).then(void 0,a);K(i=t())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,a)}function l(e){e?(i=t())&&i.then?i.then(c).then(void 0,a):c(i):V(s,1,i)}function q(){(o=e())?o.then?o.then(l).then(void 0,a):l(o):V(s,1,i)}}(function(){return u<e},function(){return u++},function(){return t=p({},t,{qTop:1e3*u}),Promise.resolve(r.getHyperCubeData("/qHyperCubeDef",[t])).then(function(e){o.push.apply(o,(n=e)[0].qMatrix)})});return s&&s.then?s.then(i):i()},function(e){se(e)}))}catch(e){return Promise.reject(e)}},[]),de=u(function(e){try{return Promise.resolve(ie.current.getListObjectData("/qListObjects/"+e+"/qListObjectDef",[ue.current]))}catch(e){return Promise.reject(e)}}),pe=u(function(e){try{return e.qListObjects?Promise.resolve(Promise.all(e.qListObjects.map(function(e,r){try{return Promise.resolve(de(r))}catch(e){return Promise.reject(e)}}))):Promise.resolve()}catch(e){return Promise.reject(e)}},[]),he=u(function(e){try{return Promise.resolve(0===e.qHyperCube.qDimensionInfo.length?null:e.qHyperCube.qDimensionInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),me=u(function(e){try{return Promise.resolve(0===e.qHyperCube.qMeasureInfo.length?null:e.qHyperCube.qMeasureInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),ye=u(function(){return function(){try{var e=ue.current.qWidth,r={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(ie.current.getHyperCubeReducedData("/qHyperCubeDef",[r],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),be=u(function(e,r){try{if(0===e.qHyperCube.qDimensionInfo.length&&0===e.qHyperCube.qMeasureInfo.length||!r)return Promise.resolve();var t=1===e.qHyperCube.qDimensionInfo.length?function(e,r,t){var n=void 0!==r?r.qDimensionInfo.length:1,o=H(r),i=R(r);return e.qMatrix.map(function(e,u){var s={},a={};return e.forEach(function(c,l){var q,f;if(l<n){var d=e[l].qAttrExps;void 0!==d&&d.qValues.forEach(function(e,t){void 0!==e.qText&&(a[r.qDimensionInfo[l].qAttrExprInfo[t].id]="NaN"!==e.qNum?e.qNum:e.qText)})}else{var h=e[l].qAttrExps;void 0!==h&&h.qValues.forEach(function(e,t){void 0!==e.qText&&(a[r.qMeasureInfo[l- -n].qAttrExprInfo[t].id]="NaN"!==e.qNum?e.qNum:e.qText)})}var m=l<n?((q={})[i[l]]=e[l].qText,q["elemNumber"+(0!==l?l:"")]=e[l].qElemNumber,q.key=u,q.label=e[l].qText,q):((f={})[o[l-n]]=t[l].qNumFormat||t[l].qNumType||t[l].qNumFmt?e[l].qText:"NaN"!==e[l].qNum?e[l].qNum:0,f.key=u,f);s=p({},s,m,a)}),s})}(r,e.qHyperCube,c):function(e,r){var t=void 0!==r?r.qDimensionInfo.length:1;H(r);var n=R(r),o=e.qMatrix[0][0].qText,i=[],u={};return e.qMatrix.map(function(e,r){var s=null,a=null,c=null;e.forEach(function(r,n){n<t&&0!==n?(s=e[n].qText,c=e[n].qElemNumber):0!==n&&(a=e[n].qNum)}),o!==e[0].qText?(0===Object.keys(u).length&&(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c),i.push(u),u={}):(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c,u.label=e[0].qText),o=e[0].qText}),i.push(u),i}(r,e.qHyperCube);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},[]),ve=u(function(e,r){try{if(!e)return Promise.resolve(r.map(function(e){return e.qFallbackTitle}));var t=e.filter(function(e){return"multiDimDataKeys"===Object.keys(e)[0]});return Promise.resolve(t[0].multiDimDataKeys)}catch(e){return Promise.reject(e)}},[]),ge=u(function(e,r){try{var t=[];return r.qListObjects?(r.qListObjects.map(function(r,n){var o={},i=r.qListObject.qDimensionInfo.qFallbackTitle,u=e[n][0]?e[n][0].qMatrix.map(function(e){return e[0].qText}):null;o[i]=u,t.push(o)}),Promise.resolve(t)):Promise.resolve(null)}catch(e){return Promise.reject(e)}},[]),Se=u(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),Ce=u(function(e,r){try{if(!r)return Promise.resolve();var t={};return r.map(function(r){t[r.qName]=e[r.qName]}),Promise.resolve(t)}catch(e){return Promise.reject(e)}},[]),Pe=u(function(){try{return Promise.resolve(le()).then(function(e){return Promise.resolve(M(e)).then(function(r){return Promise.resolve(Math.ceil(e.qHyperCube.qSize.qcy/ae)<=1?qe():fe(Math.ceil(e.qHyperCube.qSize.qcy/ae))).then(function(r){return Promise.resolve(pe(e)).then(function(t){return Promise.resolve(be(e,r)).then(function(n){return Promise.resolve(he(e)).then(function(o){return Promise.resolve(me(e)).then(function(i){return Promise.resolve(ge(t,e)).then(function(u){return Promise.resolve(ve(u,e.qHyperCube.qMeasureInfo)).then(function(s){return Promise.resolve(Se(e)).then(function(a){var c=f;return Promise.resolve(Ce(e,h)).then(function(l){if(r&&k.current){var q=r.qMatrix.filter(function(e){return"S"===e[0].qState});w({type:"update",payload:{title:a,subTitle:c,qData:r,mData:n,nameKey:o,valueKey:i,qListData:t,dataList:u,dataKeys:s,metrics:l,qLayout:e,selections:q}})}else k.current&&w({type:"update",payload:{title:a,subTitle:c,metrics:l,qData:r,mData:n,nameKey:o,valueKey:i,qListData:t,dataList:u,dataKeys:s,qLayout:e}});var f=function(){if(T)return Promise.resolve(ye()).then(function(e){k.current&&w({type:"updateReducedData",payload:{qRData:e}})})}();if(f&&f.then)return f.then(function(){})})})})})})})})})})})})}catch(e){return Promise.reject(e)}},[qe,le,T,ye]),De=u(function(e){ue.current=p({},ue.current,e),Pe()},[Pe]),xe=u(function(){return ie.current.beginSelections(["/qHyperCubeDef"])},[!0]),Le=u(function(e){return ie.current.endSelections(e)},[]),Ie=u(function(e,r,t){return void 0===t&&(t=!1),ie.current.selectHyperCubeValues("/qHyperCubeDef",e,r,t)},[]),Te=u(function(e){return ie.current.applyPatches(e)},[]),Oe=u(function(e,r){try{return Promise.resolve(Te([{qOp:"replace",qPath:"/qHyperCubeDef/"+(e?"qMeasures":"qDimensions")+"/0/qDef/"+(e?"qDef":"qFieldDefs"),qValue:JSON.stringify(e?r:[r])}])).then(function(){})}catch(e){return Promise.reject(e)}},[Te,te]);n(function(){if(oe&&!ie.current)try{var e=ce();return Promise.resolve(oe).then(function(r){return Promise.resolve(r.createSessionObject(e)).then(function(r){ie.current=r,ie.current.on("changed",function(){Pe(e.qHyperCubeDef.qMeasures)}),Pe(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[ce,oe,Pe]),n(function(){return function(){return k.current=!1}},[]);var je={};return Z&&(je.data=Z),Z&&(je.select=Ie),ee&&0!==ee.length&&(je.dataKeys=ee),Y&&(je.dataList=Y),Q&&(je.nameKey=Q),X&&(je.valueKey=X),{beginSelections:xe,endSelections:Le,qLayout:te,qData:J,mData:Z,qListData:$,dataList:Y,handlerChange:Oe,dataKeys:ee,nameKey:Q,dataSet:je,title:N,subTitle:B,metrics:A,qRData:re,changePage:De,selections:ne,select:Ie,applyPatches:Te}};function Z(e,r,t,n,o,i,u,s,a,c,l,q,f,d,p){var h={qInfo:{qType:"visualization"}};if(t){var m=t;return e&&e[1]&&(m.qMeasures[0].qDef={qDef:e[1]}),e&&e[0]&&(m.qDimensions[0].qDef.qFieldDefs=[e[0]]),h.qInfo.qType="HyperCube",h.qHyperCubeDef=m,h}var y=i||[],b=!!i,v=0,g=e.filter(function(e,r){var t="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=");return t&&!b&&(y[r]=v,v+=1),t}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:n,qSortByLoadOrder:o}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qGrouping:e.qGrouping||"N",qFieldDefs:Array.isArray(e.qField)?[].concat(e.qField):[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:o,qSortByAscii:n}]},qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),S=e.filter(function(e,r){var t="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=");return t&&!b&&(y[r]=v,v+=1),t}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return h.qHyperCubeDef={qDimensions:g,qMeasures:S,qInterColumnSortOrder:i,qSuppressZero:u,qSuppressMissing:c,qColumnOrder:q,qCalcCondition:f,qTitle:r},h}var Q={qData:null,qRData:null,qLayout:null,headerGroup:null,selections:null};function X(e,r){var t=r.payload,n=t.title,o=t.qData,i=t.dataSet,u=t.qRData,s=t.headerGroup,a=t.qLayout,c=t.selections;switch(r.type){case"update":return p({},e,{title:n,qData:o,dataSet:i,headerGroup:s,qLayout:a,selections:c});case"updateReducedData":return p({},e,{qRData:u});default:throw new Error}}var $={cols:null,qHyperCubeDef:null,qTitle:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:300},sortCriteria:{qInterColumnSortOrder:[],qSortByAscii:1,qSortByLoadOrder:1,qExpression:null,qSortByNumeric:-1,qSortByExpression:0},qSuppressZero:!1,qSuppressMissing:!0,getQRData:!1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},Y=function(e){var s=O($,e),a=s.cols,c=s.qTitle,l=s.qHyperCubeDef,q=s.qPage,f=s.sortCriteria,h=s.qSuppressZero,m=s.qSuppressMissing,y=s.qColumnOrder,b=s.qCalcCondition,v=s.getQRData,g=s.qOtherTotalSpec,S=o(!0),C=i(X,Q),P=C[0],D=C[1],x=f.qInterColumnSortOrder,L=f.qSortByAscii,I=f.qSortByLoadOrder,T=f.qExpression,j=f.qSortByNumeric,k=f.qSortByExpression,E=P.title,F=P.qData,w=P.dataSet,N=P.qRData,B=P.headerGroup,A=P.qLayout,H=P.selections,R=(r(d)||{}).engine,W=o(null),z=o(q),V=t()[1],_=t(z.current.qHeight)[0],K=t(0),U=K[0],G=K[1],J=u(function(e){G(e),fe({qTop:e*_})},[fe,_]);window.setPage=J;var Y,ee=t(0),re=ee[0],te=ee[1],ne=u(function(e){U>=e&&J(0),te(e)},[U,J]),oe=u(function(e){J(e)},[J]);n(function(){A&&F&&ne(Math.ceil(A.qHyperCube.qSize.qcy/_))},[A,F,_,J,ne]),"object"==typeof g?Y={qOtherMode:"OTHER_COUNTED",qOtherCounted:g.qOtherCount}:g?Y={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:g||(Y={qOtherMode:"OTHER_OFF",qOtherCounted:""});var ie=u(function(){return Z(a,c,l,L,I,x,h,j,k,m,T,y,b,g,Y)},[a,c,T,l,x,L,k,I,m,g,h]),ue=u(function(){return W.current.getLayout()},[]),se=u(function(){try{return Promise.resolve(function(e,r){try{var t=Promise.resolve(W.current.getHyperCubeData("/qHyperCubeDef",[z.current])).then(function(e){return e[0]})}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}(0,function(e){V(e)}))}catch(e){return Promise.reject(e)}},[]),ae=u(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),ce=u(function(){return function(){try{var e=z.current.qWidth,r={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(W.current.getHyperCubeReducedData("/qHyperCubeDef",[r],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),le=u(function(e,r,t){try{var n=function(e,r,t){return e.qMatrix.map(function(e,r){var n={};return e.forEach(function(o,i){var u,s=((u={})[t[i].dataKey]={text:e[i].qText,number:e[i].qNum,elemNumber:e[i].qElemNumber,state:e[i].qState,attrExp:e[i].qAttrExps,columnId:i},u.key=r,u);n=p({},n,s)}),n})}(r,0,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},[]),qe=u(function(){try{return Promise.resolve(ue()).then(function(e){return Promise.resolve(ae(e)).then(function(r){return Promise.resolve(M(e)).then(function(t){return Promise.resolve(se()).then(function(t){return Promise.resolve(function(e){var r=[],t=[];return function(e){e.filter(function(e,r){return"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=")}).map(function(e){return r.push(e),e})}(e),function(e){e.filter(function(e,r){return"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=")}).map(function(e){return t.push(e),e})}(e),r.concat(t)}(a)).then(function(n){function o(o){function i(n){if(t&&S.current){var i=t.qMatrix.filter(function(e){return"S"===e[0].qState});D({type:"update",payload:{title:r,qData:t,dataSet:o,headerGroup:n,qLayout:e,selections:i}})}else S.current&&D({type:"update",payload:{title:r,qData:t,dataSet:o,headerGroup:n,qLayout:e}});var u=function(){if(v)return Promise.resolve(ce()).then(function(e){S.current&&D({type:"updateReducedData",payload:{qRData:e}})})}();if(u&&u.then)return u.then(function(){})}return t?Promise.resolve(function(e,r,t){return e?[].concat(e.qHyperCube.qDimensionInfo.map(function(e,t){return{title:e.qFallbackTitle,dataIndex:r[t].dataKey,dataKey:r[t].dataKey,render:r[t].render,defaultSortDesc:"D"===e.qSortIndicator,qInterColumnIndex:t,qPath:"/qHyperCubeDef/qDimensions/"+t,qSortIndicator:e.qSortIndicator,qReverseSort:e.qReverseSort,qGrandTotals:{qText:null,qNum:null},qColumnType:"dim"}}),e.qHyperCube.qMeasureInfo.map(function(t,n){return{title:t.qFallbackTitle,dataIndex:r[e.qHyperCube.qDimensionInfo.length+n].dataKey,dataKey:r[e.qHyperCube.qDimensionInfo.length+n].dataKey,render:r[e.qHyperCube.qDimensionInfo.length+n].render,defaultSortDesc:"D"===t.qSortIndicator,qInterColumnIndex:n+e.qHyperCube.qDimensionInfo.length,qPath:"/qHyperCubeDef/qMeasures/"+n,qSortIndicator:t.qSortIndicator,qReverseSort:t.qReverseSort,qGrandTotals:e.qHyperCube.qGrandTotalRow[n],qColumnType:"meas"}})):[]}(e,n)).then(i):i(t)}return t?Promise.resolve(le(e,t,n)).then(o):o(t)})})})})})}catch(e){return Promise.reject(e)}},[se,ue,v,ce]),fe=u(function(e){z.current=p({},z.current,e),qe()},[qe]),de=u(function(){return W.current.beginSelections(["/qHyperCubeDef"])},[!0]),pe=u(function(e){return W.current.endSelections(e)},[]),he=u(function(e,r,t){return void 0===t&&(t=!1),W.current.selectHyperCubeValues("/qHyperCubeDef",e,r,t)},[]),me=u(function(e){return W.current.applyPatches(e)},[]),ye=u(function(e){try{var r=function(){return Promise.resolve(me([{qOp:"replace",qPath:e.qPath+"/qDef/qReverseSort",qValue:JSON.stringify(!e.qReverseSort)},{qOp:"replace",qPath:"/qHyperCubeDef/qInterColumnSortOrder",qValue:JSON.stringify([].concat(A.qHyperCube.qEffectiveInterColumnSortOrder).sort(function(r,t){return r===e.qInterColumnIndex?-1:t===e.qInterColumnIndex?1:0}))}])).then(function(){J(0)})},t=function(){if("N"===e.qSortIndicator){var r=function(){var r=function(){if(e.qPath.includes("qMeasures"))return Promise.resolve(me([{qOp:"add",qPath:e.qPath+"/qSortBy",qValue:JSON.stringify({qSortByLoadOrder:1})}])).then(function(){})}();if(r&&r.then)return r.then(function(){})},t=function(){if(e.qPath.includes("qDimensions"))return Promise.resolve(me([{qOp:"add",qPath:e.qPath+"/qDef/qSortCriterias",qValue:JSON.stringify([{qSortByLoadOrder:1}])}])).then(function(){})}();return t&&t.then?t.then(r):r()}}();return Promise.resolve(t&&t.then?t.then(r):r())}catch(e){return Promise.reject(e)}},[me,A]);return n(function(){if(R&&!W.current)try{var e=ie();return Promise.resolve(R).then(function(r){return Promise.resolve(r.createSessionObject(e)).then(function(r){W.current=r,W.current.on("changed",function(){qe(e.qHyperCubeDef.qMeasures)}),qe(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[ie,R,qe]),n(function(){return function(){return S.current=!1}},[]),{beginSelections:de,endSelections:pe,title:E,qLayout:A,qData:F,dataSet:w,headerGroup:B,handleSortChange:ye,qRData:N,changePage:fe,selections:H,select:he,applyPatches:me,incrementPage:function(){oe(U+1)},decrementPage:function(){oe(0==U?re-1:U-1)},handlePageChange:oe,page:U,pageSize:_,pages:re}},ee=require("enigma.js"),re=require("enigma.js/schemas/12.170.2.json"),te=require("enigma.js/sense-utilities");function ne(e){var r=[{onRejected:function(e,r,t){return console.warn("Captured Request: Rejected","Error Code: "+t.code+" : "+t),t.code===re.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(r.tries=(r.tries||0)+1,console.warn("Captured Request: Retry #"+r.tries),r.tries<=3)?r.retry():t.code===re.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||t.code===re.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?t.code:(console.warn(t),this.Promise.reject(t))}}],n=t(!1),o=n[0],i=n[1],u=t(null),s=u[0],a=u[1],c=t(function(){!function(){try{var t,n=function(n){return t?n:function(){if(e){var t=te.buildUrl(e);return function(e,n){try{var o=((i=ee.create({schema:re,url:t,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),i.on("error",function(){console.warn("Captured session error")}),i.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(i.open()).then(function(e){return Promise.resolve(e.engineVersion()).then(function(r){return Promise.resolve(e.getDocList({})).then(function(t){return Promise.resolve(e.oSName()).then(function(n){return Promise.resolve(e.oSVersion()).then(function(o){return l({global:e,docList:t,engineVersion:r,oSName:n,oSVersion:o}),a(1),1})})})})}))}catch(e){return n(e)}var i;return o&&o.then?o.then(void 0,n):o}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(e&&e.qcs){var n=e.host,o=e.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),t=1,-1;var s=ee.create({schema:re,url:"wss://"+n+"/app/"+e.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(e){return Promise.resolve(e.engineVersion()).then(function(r){return Promise.resolve(e.getDocList({})).then(function(n){return Promise.resolve(e.oSName()).then(function(o){return Promise.resolve(e.oSVersion()).then(function(i){return l({global:e,docList:n,engineVersion:r,oSName:o,oSVersion:i}),a(1),t=1})})})})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return p({},c[0],{globalError:o,errorCode:s})}var oe,ie,ue={qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e3},cols:null,qHyperCubeDef:null,config:null},se=function(e){var i=O(ue,e),s=i.cols,a=i.qHyperCubeDef,c=(r(d)||{}).engine,l=t(null),q=l[0],f=l[1],p=o(!0),h=o(null),m=u(function(){return Z(s,a)},[s,a]);return n(function(){if(c&&s&&!h.current)try{var e=m();return Promise.resolve(c).then(function(r){return Promise.resolve(r.createSessionObject(e)).then(function(e){return h.current=e,Promise.resolve(h.current.getLayout()).then(function(e){f(e)})})})}catch(e){Promise.reject(e)}},[m,c]),n(function(){return function(){return p.current=!1}},[]),{clearSelections:function(){c&&c.clearAll()},previousSelection:function(){c&&c.back()},nextSelection:function(){c&&c.forward()},qLayout:q,exportData:function(e){c.getObject(q.qInfo.qId).then(function(e){e.exportData("CSV_C","/qHyperCubeDef","Test","P").then(function(e){console.log(e.qUrl,e.qWarnings)})})},select:function(e,r){try{return Promise.resolve(c).then(function(t){return Promise.resolve(t.getField(r)).then(function(r){r.select(e)})})}catch(e){return Promise.reject(e)}},selectValues:function(e,r,t){void 0===t&&(t=!1);try{return Promise.resolve(e.map(function(e){return{qText:e}})).then(function(e){return Promise.resolve(c).then(function(n){return Promise.resolve(n.getField(r)).then(function(r){r.selectValues(e,t)})})})}catch(e){return Promise.reject(e)}},doReload:function(e,r){try{return Promise.resolve(c).then(function(t){t.doReload(e,r,!1)})}catch(e){return Promise.reject(e)}}}},ae=function(e){var i=e.searchValue,s=e.dimensions,a=e.qCount,c=e.qGroupItemCount,l=t([]),q=l[0],f=l[1],p=t([]),h=p[0],m=p[1],y=o(!0),b=(r(d)||{}).engine;n(function(){void 0===b||function(){try{var e=function(e,r){try{var t=Promise.resolve(b).then(function(e){return Promise.resolve(e.searchResults({qSearchFields:s},[i],{qOffset:0,qCount:a,qGroupItemOptions:[{qGroupItemType:"FIELD",qOffset:0,qCount:c}]})).then(function(e){return Promise.resolve(e).then(function(e){return Promise.resolve(v(e)).then(function(e){return Promise.resolve(g(e)).then(function(r){f(e),m(r),y.current&&(f(e),m(r))})})})})})}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}(0,function(e){console.warn(e)});e&&e.then&&e.then(function(){})}catch(e){Promise.reject(e)}}()},[b,i,a,c,s]),n(function(){return function(){return y.current=!1}},[]);var v=function(e){var r=[],t={};return e.qSearchGroupArray.map(function(e){t.id=e.qId,t.dimension=e.qItems[0].qIdentifier,t.value=e.qItems[0].qItemMatches,r.push(t),t={}}),r},g=function(e){var r=[],t={};return e.map(function(e){e.value.map(function(n){t.dimension=e.dimension,t.value=n.qText,r.push(t),t={}})}),r},S=u(function(e){return function(){try{return Promise.resolve(b).then(function(r){r.selectAssociations({qSearchFields:s,qContext:"CurrentSelections"},[i],e)})}catch(e){return Promise.reject(e)}}()});return{groupResults:q,flatResults:h,flatSelect:u(function(e,r){return function(){try{return Promise.resolve(b).then(function(t){return Promise.resolve(t.getField(e)).then(function(e){e.select(r)})})}catch(e){return Promise.reject(e)}}()}),groupSelect:S}},ce=null,le=null,qe=function(){var e=(r(d)||{}).engine,i=o(!0),s=t(null),a=s[0],c=s[1],l=t(null),q=l[0],f=l[1],p=u(function(){try{return Promise.resolve(le.getLayout()).then(function(e){return Promise.resolve(h(e)).then(function(r){i.current&&(c(e),f(r))})})}catch(e){return Promise.reject(e)}},[]),h=function(e){return e.qSelectionObject.qSelections};return n(function(){if(void 0===e);else try{var r={qInfo:{qType:"SelectionObject"},qSelectionObjectDef:{}};return Promise.resolve(e).then(function(e){return ce=e,Promise.resolve(ce.createSessionObject(r)).then(function(e){(le=e).on("changed",function(){p()}),p()})})}catch(e){Promise.reject(e)}},[e,p]),n(function(){return function(){return i.current=!1}},[]),{qLayout:a,selections:q,clearSelections:function(e,r){try{var t=function(){if(e)return Promise.resolve(ce.getField(e)).then(function(e){var t=r?Promise.resolve(e.toggleSelect(r)).then(function(){}):Promise.resolve(e.clear()).then(function(){});if(t&&t.then)return t.then(function(){})});ce.clearAll()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}}},fe={Uid:function(e){for(var r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t=e||8,n="",o=0;o<t;o+=1)n+=r.charAt(Math.floor(Math.random()*r.length));return n},globals:{qlik:null,resize:null}};function de(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function pe(e){var r=t(function(){!function(){try{!function(){if(e&&e.qcs){var r={host:e.host,isSecure:e.secure,port:e.port||443,prefix:""!==e.prefix?"/"+e.prefix+"/":"/",appId:e.appId,webIntegrationId:e.webIntId};return de(function(){return Promise.resolve(function(e){try{var r;return Promise.resolve(de(function(){function t(t){if(r)return t;var n=e.host,o=e.webIntId,i=document.createElement("link");i.rel="stylesheet",i.href="https://"+n+"/resources/autogenerated/qlik-styles.css",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}});var u=document.createElement("script");return u.src="https://"+n+"/resources/assets/external/requirejs/require.js",u.onload=function(){try{return window.require.config({baseUrl:"https://"+n+"/resources",webIntegrationId:o}),Promise.resolve()}catch(e){return Promise.reject(e)}},document.body.appendChild(u),u.loaded=new Promise(function(e){u.onload=function(){e()}}),ie=Promise.all([i.loaded,u.loaded]),Promise.resolve(ie).then(function(){})}var n=function(){if(ie)return Promise.resolve(ie).then(function(){r=1})}();return n&&n.then?n.then(t):t(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(r)).then(function(){window.require.config({baseUrl:"https://"+r.host+"/resources",webIntegrationId:e.webIntId}),window.require(["js/qlik"],function(e){try{var t=e.openApp(r.appId,r);return t.theme.get().then(function(e){e.apply()}),n(t),Promise.resolve(1)}catch(e){return Promise.reject(e)}})})},function(e){throw new Error(e)})}de(function(){return Promise.resolve(function(e){try{var r;return Promise.resolve(de(function(){function t(t){if(r)return t;var n=document.createElement("script"),o=""!==e.prefix?"/"+e.prefix:"";n.src=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/assets/external/requirejs/require.js",document.head.appendChild(n),n.loaded=new Promise(function(e){n.onload=function(){e()}});var i=document.createElement("link");return i.href=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/autogenerated/qlik-styles.css",i.type="text/css",i.rel="stylesheet",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}}),oe=Promise.all([n.loaded,i.loaded]),Promise.resolve(oe).then(function(){})}var n=function(){if(oe)return Promise.resolve(oe).then(function(){r=1})}();return n&&n.then?n.then(t):t(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(e)).then(function(){var r=""!==e.prefix?"/"+e.prefix+"/":"/";return window.require.config({baseUrl:(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+r+"resources",paths:{qlik:(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+r+"resources/js/qlik"},config:{text:{useXhr:function(){return!0}}}}),new Promise(function(t){if(fe.globals.qlik){var o=fe.globals.qlik.openApp(e.appId,p({},e,{isSecure:e.secure,prefix:r}));o.theme.get().then(function(e){e.apply()}),n(o)}else window.require(["js/qlik"],function(t){fe.globals.qlik=t,fe.globals.resize=function(){t.resize()};var o=t.openApp(e.appId,p({},e,{isSecure:e.secure,prefix:r}));return n(o),1})})})},function(e){throw new Error(e)})}()}catch(e){Promise.reject(e)}}()},[]),n=r[1];return{app:r[0]}}var he=function(){var e=(r(d)||{}).engine,o=t(),i=o[0],u=o[1],s=function(r,t){try{return Promise.resolve(e).then(function(e){e.doReload(r,t,!1)})}catch(e){return Promise.reject(e)}};return n(function(){return function(){try{var r=function(){if(void 0!==e)return Promise.resolve(e).then(function(e){return Promise.resolve(e.getAppProperties()).then(function(r){u(p({app:e,appProperties:r},r,{doReload:s}))})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[e]),p({},i)},me=function(){var e=(r(d)||{}).engine,o=t(null),i=o[0],u=o[1],s=t(null),a=s[0],c=s[1];return n(function(){return function(){try{if(!e)return Promise.resolve();var r=function(r,t){try{var n=Promise.resolve(e).then(function(e){return Promise.resolve(e.getAppLayout()).then(function(e){u(p({appLayout:e},e))})})}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}(0,function(e){c(e)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[e]),p({},i,{error:a})};function ye(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var be={id:null,comment:void 0,numberPresentation:void 0,includeInBookmark:!1,definition:null},ve=function(e){var i="string"==typeof e?e:e.name||null,s=O(be,e),a=s.id,c=s.comment,l=s.numberPresentation,q=s.includeInBookmark,f=s.definition,h=(r(d)||{}).engine,m=t(null),y=m[0],b=m[1],v=t(null),g=v[0],S=v[1],C=t(null),P=C[0],D=C[1],x=o(null),L=function(e,r,t,n,o,i){return{qInfo:{qId:e,qType:"Variable"},qMetaDef:{},qName:r,qComment:t,qNumberPresentation:n,qIncludeInBookmark:o,qDefinition:i.toString()}},I=u(function(){return x.current.getLayout()},[]),T=u(function(){return x.current.getProperties()},[]),j=u(function(e){try{var r=e.qId,t=e.qName,n=e.qComment,o=e.qNumberPresentation,i=e.qIncludeInBookmark,u=e.qDefinition,s=function(){if(x.current)return Promise.resolve(T()).then(function(e){return Promise.resolve(x.current.setProperties(L(r||e.qInfo.qId,t||e.qName,n||e.qComment,o||e.qNumberPresentation,i||e.qIncludeInBookmark,u.toString()||e.qDefinition.toString()))).then(function(e){E(e.current)})})}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),k=u(function(e){try{var r=function(){if(x.current)return Promise.resolve(T()).then(function(r){return Promise.resolve(x.current.setProperties(L(r.qInfo.qId,r.qName,r.qComment,r.qNumberPresentation,r.qIncludeInBookmark,e.toString()))).then(function(e){E(e.current)})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),E=u(function(e){try{return Promise.resolve(I()).then(function(e){return e.value="number"===e.qNum?e.qNum:e.qText,b(e),Promise.resolve(T()).then(function(e){S(e)})})}catch(e){return Promise.reject(e)}},[]);return n(function(){if(h)try{return Promise.resolve(h).then(function(e){var r=ye(function(){return Promise.resolve(function(e,r,t,n,o,i){try{return Promise.resolve(h).then(function(u){function s(){function s(){function s(){var s=function(){if(r&&i){var s=ye(function(){return Promise.resolve(u.getVariableByName({qName:r})).then(function(e){a=e})},function(s){function c(){(P.code=18001)?D("Variable already exists"):D(s)}var l=function(){if(!a)return Promise.resolve(u.createSessionVariable(L(e,r,t,n,o,i))).then(function(e){return a=e,Promise.resolve(a).then(function(e){x.current=e,E(x.current)})})}();return l&&l.then?l.then(c):c()});if(s&&s.then)return s.then(function(){})}}();return s&&s.then?s.then(function(){return a}):a}var c=function(){if(r&&!i)return Promise.resolve(u.getVariableByName({qName:r})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var c=function(){if(e&&!i)return Promise.resolve(u.getVariableById({qId:e})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var a,c=function(){if(!e&&!r&&!i)return Promise.resolve(u.createSessionObject({qInfo:{qId:"VL01",qType:"VariableList"},qVariableListDef:{qType:"variable"}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){b(a=e)})})}();return c&&c.then?c.then(s):s()})}catch(e){return Promise.reject(e)}}(a,i,c,l,q,f)).then(function(e){x.current=e,x.current.on("changed",function(){E(x.current)}),E(x.current)})},function(e){D(-2===e.code?"Variable Not Found":e)});if(r&&r.then)return r.then(function(){})})}catch(e){Promise.reject(e)}},[a,i,h]),y&&y.qVariableList&&(y.variableList=y.qVariableList.qItems),p({qLayout:y},y,{qProperties:g,setProperties:j,setValue:k,error:P})},ge=function(e){var i=(r(d)||{}).engine,s=t(null),a=s[0],c=s[1],l=t(null),q=l[0],f=l[1],h=o(null),m=u(function(e){return h.current.getBookmark({qId:e})},[]),y=function(){try{return Promise.resolve(b()).then(function(e){var r=e.map(function(e,r){return{id:e.qInfo.qId,title:e.qMeta.title,description:e.qMeta.description,modifiedDate:e.qData.qBookmark.qUtcModifyTime}});c({bookmarks:e,bookmarkList:r})})}catch(e){return Promise.reject(e)}},b=u(function(){return h.current.getBookmarks({qOptions:{qTypes:["bookmark"],qData:{}}})}),v=u(function(){return y(),Promise.resolve()},[]);return n(function(){if(i&&!h.current)try{return Promise.resolve(i).then(function(e){try{h.current=e,h.current.on("changed",function(){v()}),v()}catch(e){f(-2===e.code?"Bookmark Not Found":e)}})}catch(e){Promise.reject(e)}},[i]),p({},a,{applyBookmark:function(e){try{var r=h.current&&h.current.applyBookmark({qId:e}),t=function(){if(r)return Promise.resolve(m(e)).then(function(e){return Promise.resolve(e.getLayout()).then(function(r){c(p({},a,{appliedBookmark:e,bookmarkInfo:r}))})})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},createBookmark:function(e,r,t){void 0===t&&(t=null);try{return Promise.resolve(h.current.createBookmark({qProp:{qInfo:{qId:t,qType:"bookmark"},qMetaDef:{title:e||"Unnamed bookmark",description:r}}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){return y(),e})})}catch(e){return Promise.reject(e)}},destroyBookmark:function(e){try{return Promise.resolve(h.current.destroyBookmark({qId:e})).then(function(e){return y(),e})}catch(e){return Promise.reject(e)}},getBookmark:m,getBookmarkLayout:function(e){try{return Promise.resolve(h.current.getBookmark({qId:e})).then(function(e){return Promise.resolve(e.getLayout())})}catch(e){return Promise.reject(e)}},updateBookmark:function(e,r,t){try{return Promise.resolve(m(e)).then(function(n){return Promise.resolve(n.setProperties({qProp:{qInfo:{qId:e,qType:"bookmark"},qMetaDef:{title:r,description:t}}})).then(function(){y()})})}catch(e){return Promise.reject(e)}},error:q})};export{d as EngineContext,v as Login,I as Motor,L as NotConnected,he as useApp,ge as useBookmark,se as useButton,pe as useCapability,J as useData,D as useEngine,ne as useGlobal,F as useHyperCube,me as useLayout,A as useList,ae as useSearch,qe as useSelections,Y as useTable,ve as useVariable};
//# sourceMappingURL=index.es.ts.map
