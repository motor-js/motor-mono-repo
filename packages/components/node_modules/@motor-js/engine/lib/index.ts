!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-watermark-component"),require("prop-types"),require("react/jsx-runtime"),require("crypto-js/aes"),require("crypto-js/enc-utf8")):"function"==typeof define&&define.amd?define(["exports","react","react-watermark-component","prop-types","react/jsx-runtime","crypto-js/aes","crypto-js/enc-utf8"],t):t((e||self).engine={},e.react,e.reactWatermarkComponent,e.propTypes,e.jsx,e.CryptoAES,e.CryptoENC)}(this,function(e,t,r,n,o,i,u){function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(t),c=s(r),l=s(n),q=s(i),f=s(u),d=a.default.createContext();function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function h(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(r=i[n])>=0||(o[r]=e[r]);return o}var m,y=function(e){var t=e.config,r=e.header,n=e.body,i=e.bodySub,u=e.buttonText,s=e.buttonFontColor,a=e.buttonColor,c=e.logo,l=e.loginfontFamily,q=t.host,f=t.webIntId;return o.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[o.jsx("div",{style:{fontFamily:l,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:o.jsx("div",{size:e.size,style:{padding:"0.6rem",fontSize:"18px"},children:c?o.jsx("img",{src:c,height:e.logoHeight,width:e.logoWidth,alt:"Logo"}):r})}),o.jsxs("div",{style:{fontFamily:l,width:"100%",display:"flex",boxSizing:"border-box",padding:"0.8rem",WebkitAlignItems:"center",WebkitBoxAlign:"center",msFlexAlign:"center",alignItems:"center",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"column",msFlexDirection:"column",flexDirection:"column",WebkitFlex:"column",msFlex:"0 0 auto",flex:"0 0 auto"},children:[o.jsx("div",{style:{padding:"0.6rem",fontSize:"14px"},children:n}),o.jsx("div",{style:{padding:"0.6rem",fontSize:"14px"},children:i}),o.jsx("button",{style:{fontFamily:l,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:a,borderRadius:"8px",color:s,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){var e=new URL("https://"+q+"/login");e.searchParams.append("returnto",window.location.href),e.searchParams.append("qlik-web-integration-id",f),window.location.href=e},children:u})]})]})})},b=["config"],v=function(e){var r=e.config,n=h(e,b),i=t.useContext(d).errorCode;return o.jsx("div",{style:{display:-1===i?"":"none"},children:r&&i&&o.jsx(y,p({config:r},n))})};v.propTypes=((m={config:l.default.object,header:l.default.string,body:l.default.string,bodySub:l.default.string,size:l.default.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:l.default.string,backgroundColor:l.default.string,buttonFontColor:l.default.string,buttonColor:l.default.string,logo:l.default.string,logoHeight:l.default.string,logoWidth:l.default.string}).header=l.default.string,m.loginfontFamily=l.default.string,m),v.defaultProps={config:null,logo:null,logoHeight:null,logoWidth:null,header:"Welcome to your motor js mashup",body:"Please log on to access your application",bodySub:"",size:"medium",buttonText:"Login",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var C=function(e){var t=e.body,r=e.size,n=e.buttonText,i=e.buttonFontColor,u=e.buttonColor,s=e.loginfontFamily;return o.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[o.jsx("div",{style:{fontFamily:s,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:o.jsx("div",{size:r,style:{padding:"0.8rem",fontSize:"16px"},children:e.header})}),o.jsxs("div",{focusable:!1,width:"100%",align:"center",direction:"column",padding:"0.8rem",children:[o.jsx("div",{size:r,style:{padding:"0.6rem",fontSize:"14px",fontFamily:s},children:t}),o.jsx("button",{style:{fontFamily:s,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:u,borderRadius:"8px",color:i,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){return location.reload()},children:n})]})]})})},g=require("enigma.js"),S=require("enigma.js/schemas/12.170.2.json"),P=require("enigma.js/sense-utilities");function D(e){var r=[{onRejected:function(e,t,r){return console.warn("Captured Request: Rejected","Error Code: "+r.code+" : "+r),r.code===S.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(t.tries=(t.tries||0)+1,console.warn("Captured Request: Retry #"+t.tries),t.tries<=3)?t.retry():r.code===S.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||r.code===S.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?r.code:(console.warn(r),this.Promise.reject(r))}}],n=t.useState(!1),o=n[0],i=n[1],u=t.useState(null),s=u[0],a=u[1],c=t.useState(function(){!function(){try{var t,n=function(n){return t?n:function(){if(e){var t=P.buildUrl(e);return function(n,o){try{var i=((u=g.create({schema:S,url:t,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),u.on("error",function(){console.warn("Captured session error")}),u.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(u.open()).then(function(t){return Promise.resolve(t.openDoc(e.appId)).then(function(e){return l(e),a(1),1})}))}catch(e){return o(e)}var u;return i&&i.then?i.then(void 0,o):i}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(e&&e.qcs){var n=e.host,o=e.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),t=1,-1;var s=g.create({schema:S,url:"wss://"+n+"/app/"+e.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(r){return Promise.resolve(r.openDoc(e.appId)).then(function(e){return l(e),a(1),t=1})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return{engine:c[0],engineError:o,errorCode:s}}var x=["config"],k=function(e){var r=e.config,n=h(e,x),i=t.useContext(d),u=D(r),s=(i||u).errorCode;return o.jsx("div",{style:{display:-3===s?"":"none"},children:r&&s&&o.jsx(C,p({},n))})};k.propTypes={header:l.default.string,body:l.default.string,size:l.default.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:l.default.string,backgroundColor:l.default.string,buttonFontColor:l.default.string,buttonColor:l.default.string,loginfontFamily:l.default.string},k.defaultProps={header:"Connection to server lost",body:"Please reload the page to refresh the dashboard",size:"medium",buttonText:"Reload Page",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var L=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},j=function e(t){var r=[].slice.call(arguments,1);if(!r.length)return t;var n=p({},t);return r.forEach(function(t){L(t)&&Object.keys(t).forEach(function(r){n[r]=L(t[r])?n[r]?e(n[r],t[r]):p({},t[r]):t[r]})}),n},I={qData:null,qRData:null,qLayout:null,selections:null};function T(e,t){var r=t.payload,n=r.qData,o=r.qRData,i=r.qLayout,u=r.selections;switch(t.type){case"update":return p({},e,{qData:n,qLayout:i,selections:u});case"updateReducedData":return p({},e,{qRData:o});default:throw new Error}}var O={cols:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},E={qDoc:null,qObject:null,qData:null,listData:null,selections:null,selectionsId:null};function F(e,t){var r=t.payload,n=r.qData,o=r.listData,i=r.selections,u=r.selectionsId,s=r.qDoc;switch(t.type){case"update":return p({},e,{qData:n,listData:o,selections:i,selectionsId:u});case"init":return p({},e,{qDoc:s});default:throw new Error}}var w={autoSortByState:1,qSortByAscii:1,qSortByLoadOrder:1,dimension:null,label:null,qListObjectDef:null,qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e4}},N=function(e){return e.qMeasureInfo.map(function(e,t){return e.qFallbackTitle})},R=function(e){return e.qDimensionInfo.map(function(e,t){return e.qFallbackTitle})},B=function(e){var t=e.qHyperCube||e.qListObject,r=t.qDimensionInfo,n=t.qMeasureInfo,o=function(){(Array.isArray(r)?r:[r]).forEach(function(e){e.qError&&console.error("There is an issue with your dimension. Please fix this in order to receive the correct data. ",e.qError)})},i=function(){n.forEach(function(e){isNaN(e.qMax)&&isNaN(e.qMin)&&console.error("There is an issue with your measure. It is not returning any data.")})};r&&n?(o(),i()):r&&!n?o():!r&&n&&i()};function A(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var H={qData:null,qRData:null,qLayout:null,selections:null};function M(e,t,r){if(!e.s){if(r instanceof W){if(!r.s)return void(r.o=M.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(M.bind(null,e,t),M.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var W=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{M(n,1,i(this.v))}catch(e){M(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?M(n,1,t?t(o):o):r?M(n,1,r(o)):M(n,2,o)}catch(e){M(n,2,e)}},n},e}();function z(e){return e instanceof W&&1&e.s}function V(e,t){var r=t.payload,n=r.title,o=r.subTitle,i=r.metrics,u=r.qData,s=r.mData,a=r.nameKey,c=r.valueKey,l=r.qListData,q=r.dataList,f=r.dataKeys,d=r.qRData,h=r.qLayout,m=r.selections;switch(t.type){case"update":return p({},e,{title:n,subTitle:o,metrics:i,qData:u,mData:s,nameKey:a,valueKey:c,qListData:l,dataList:q,dataKeys:f,qLayout:h,selections:m});case"updateReducedData":return p({},e,{qRData:d});default:throw new Error}}var _={cols:[],qLists:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qTitle:null,qSubTitle:null,qMetrics:null,qOtherTotalSpec:""};function K(e,t,r,n,o,i,u,s,a,c,l,q,f,d,p){var h={qInfo:{qType:"visualization"}};if(r){var m=r;return e&&e[1]&&(m.qMeasures[0].qDef={qDef:e[1]}),e&&e[0]&&(m.qDimensions[0].qDef.qFieldDefs=[e[0]]),h.qInfo.qType="HyperCube",h.qHyperCubeDef=m,h}var y=i||[],b=!!i,v=0,C=e.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=");return r&&!b&&(y[t]=v,v+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:n,qSortByLoadOrder:o}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qGrouping:e.qGrouping||"N",qFieldDefs:Array.isArray(e.qField)?[].concat(e.qField):[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:o,qSortByAscii:n}]},qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),g=e.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=");return r&&!b&&(y[t]=v,v+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return h.qHyperCubeDef={qDimensions:C,qMeasures:g,qInterColumnSortOrder:i,qSuppressZero:u,qSuppressMissing:c,qColumnOrder:q,qCalcCondition:f,qTitle:t},h}var U={qData:null,qRData:null,qLayout:null,headerGroup:null,selections:null};function G(e,t){var r=t.payload,n=r.title,o=r.qData,i=r.dataSet,u=r.qRData,s=r.headerGroup,a=r.qLayout,c=r.selections;switch(t.type){case"update":return p({},e,{title:n,qData:o,dataSet:i,headerGroup:s,qLayout:a,selections:c});case"updateReducedData":return p({},e,{qRData:u});default:throw new Error}}var J,Z,Q={cols:null,qHyperCubeDef:null,qTitle:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:300},sortCriteria:{qInterColumnSortOrder:[],qSortByAscii:1,qSortByLoadOrder:1,qExpression:null,qSortByNumeric:-1,qSortByExpression:0},qSuppressZero:!1,qSuppressMissing:!0,getQRData:!1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},X=require("enigma.js"),$=require("enigma.js/schemas/12.170.2.json"),Y=require("enigma.js/sense-utilities"),ee={qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e3},cols:null,qHyperCubeDef:null,config:null},te=null,re=null,ne={Uid:function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=e||8,n="",o=0;o<r;o+=1)n+=t.charAt(Math.floor(Math.random()*t.length));return n},globals:{qlik:null,resize:null}};function oe(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function ie(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var ue={id:null,comment:void 0,numberPresentation:void 0,includeInBookmark:!1,definition:null};e.EngineContext=d,e.Login=v,e.Motor=function(e){var r=e.engine,n=e.children,i=e.licenseKey,u=e.logo,s=e.logoWidth,a=e.logoHeight,l=e.header,p=e.body,h=e.bodySub,m=e.size,y=e.buttonText,b=e.buttonFontColor,C=e.buttonColor,g=e.backgroundColor,S=e.loginfontFamily,P=e.NotConnectedheader,x=e.NotConnectedBody,L=e.NotConnectedButtonText,j=t.useState(e.config)[0],I=t.useState(!0),T=I[0],O=I[1],E=r?{engine:r,engineError:null,errorCode:null}:D(j),F=i?function(e){var t,r=[];for(t=1;t<101;t++)r.push("MotorLicense-"+t);var n=q.default.decrypt(e,"S@few/M0t0r").toString(f.default);return r.filter(function(e){return e==n})}(i):[];return t.useEffect(function(){O(F.length>0)},[i]),o.jsxs(d.Provider,{value:E,children:[o.jsx(v,{config:j,logo:u,logoHeight:a,logoWidth:s,header:l,body:p,bodySub:h,size:m,backgroundColor:g,buttonText:y,buttonFontColor:b,buttonColor:C,loginfontFamily:S}),o.jsx(k,{config:j,header:P,body:x,size:m,buttonText:L,backgroundColor:g,buttonFontColor:b,buttonColor:C,loginfontFamily:S}),T?o.jsx("div",{children:n}):o.jsx(c.default,{waterMarkText:"Powered by Motor",openSecurityDefense:!0,securityAlarm:function(){console.error("start alarm!")},options:{chunkWidth:200,chunkHeight:90,textAlign:"left",textBaseline:"bottom",globalAlpha:.27,font:"16px Roboto sans-serif",rotateAngle:-.19,fillStyle:"#666"},children:n})]})},e.NotConnected=k,e.useApp=function(){var e=(t.useContext(d)||{}).engine,r=t.useState(),n=r[0],o=r[1],i=function(t,r){try{return Promise.resolve(e).then(function(e){e.doReload(t,r,!1)})}catch(e){return Promise.reject(e)}};return t.useEffect(function(){return function(){try{var t=function(){if(void 0!==e)return Promise.resolve(e).then(function(e){return Promise.resolve(e.getAppProperties()).then(function(t){o(p({app:e,appProperties:t},t,{doReload:i}))})})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[e]),p({},n)},e.useBookmark=function(e){var r=(t.useContext(d)||{}).engine,n=t.useState(null),o=n[0],i=n[1],u=t.useState(null),s=u[0],a=u[1],c=t.useRef(null),l=t.useCallback(function(e){return c.current.getBookmark({qId:e})},[]),q=function(){try{return Promise.resolve(f()).then(function(e){var t=e.map(function(e,t){return{id:e.qInfo.qId,title:e.qMeta.title,description:e.qMeta.description,modifiedDate:e.qData.qBookmark.qUtcModifyTime}});i({bookmarks:e,bookmarkList:t})})}catch(e){return Promise.reject(e)}},f=t.useCallback(function(){return c.current.getBookmarks({qOptions:{qTypes:["bookmark"],qData:{}}})}),h=t.useCallback(function(){return q(),Promise.resolve()},[]);return t.useEffect(function(){if(r&&!c.current)try{return Promise.resolve(r).then(function(e){try{c.current=e,c.current.on("changed",function(){h()}),h()}catch(e){a(-2===e.code?"Bookmark Not Found":e)}})}catch(e){Promise.reject(e)}},[r]),p({},o,{applyBookmark:function(e){try{var t=c.current&&c.current.applyBookmark({qId:e}),r=function(){if(t)return Promise.resolve(l(e)).then(function(e){return Promise.resolve(e.getLayout()).then(function(t){i(p({},o,{appliedBookmark:e,bookmarkInfo:t}))})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},createBookmark:function(e,t,r){void 0===r&&(r=null);try{return Promise.resolve(c.current.createBookmark({qProp:{qInfo:{qId:r,qType:"bookmark"},qMetaDef:{title:e||"Unnamed bookmark",description:t}}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){return q(),e})})}catch(e){return Promise.reject(e)}},destroyBookmark:function(e){try{return Promise.resolve(c.current.destroyBookmark({qId:e})).then(function(e){return q(),e})}catch(e){return Promise.reject(e)}},getBookmark:l,getBookmarkLayout:function(e){try{return Promise.resolve(c.current.getBookmark({qId:e})).then(function(e){return Promise.resolve(e.getLayout())})}catch(e){return Promise.reject(e)}},updateBookmark:function(e,t,r){try{return Promise.resolve(l(e)).then(function(n){return Promise.resolve(n.setProperties({qProp:{qInfo:{qId:e,qType:"bookmark"},qMetaDef:{title:t,description:r}}})).then(function(){q()})})}catch(e){return Promise.reject(e)}},error:s})},e.useButton=function(e){var r=j(ee,e),n=r.cols,o=r.qHyperCubeDef,i=(t.useContext(d)||{}).engine,u=t.useState(null),s=u[0],a=u[1],c=t.useRef(!0),l=t.useRef(null),q=t.useCallback(function(){return K(n,o)},[n,o]);return t.useEffect(function(){if(i&&n&&!l.current)try{var e=q();return Promise.resolve(i).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(e){return l.current=e,Promise.resolve(l.current.getLayout()).then(function(e){a(e)})})})}catch(e){Promise.reject(e)}},[q,i]),t.useEffect(function(){return function(){return c.current=!1}},[]),{clearSelections:function(){i&&i.clearAll()},previousSelection:function(){i&&i.back()},nextSelection:function(){i&&i.forward()},qLayout:s,exportData:function(e){i.getObject(s.qInfo.qId).then(function(e){e.exportData("CSV_C","/qHyperCubeDef","Test","P").then(function(e){console.log(e.qUrl,e.qWarnings)})})},select:function(e,t){try{return Promise.resolve(i).then(function(r){return Promise.resolve(r.getField(t)).then(function(t){t.select(e)})})}catch(e){return Promise.reject(e)}},selectValues:function(e,t,r){void 0===r&&(r=!1);try{return Promise.resolve(e.map(function(e){return{qText:e}})).then(function(e){return Promise.resolve(i).then(function(n){return Promise.resolve(n.getField(t)).then(function(t){t.selectValues(e,r)})})})}catch(e){return Promise.reject(e)}},doReload:function(e,t){try{return Promise.resolve(i).then(function(r){r.doReload(e,t,!1)})}catch(e){return Promise.reject(e)}}}},e.useCapability=function(e){var r=t.useState(function(){!function(){try{!function(){if(e&&e.qcs){var t={host:e.host,isSecure:e.secure,port:e.port||443,prefix:""!==e.prefix?"/"+e.prefix+"/":"/",appId:e.appId,webIntegrationId:e.webIntId};return oe(function(){return Promise.resolve(function(e){try{var t;return Promise.resolve(oe(function(){function r(r){if(t)return r;var n=e.host,o=e.webIntId,i=document.createElement("link");i.rel="stylesheet",i.href="https://"+n+"/resources/autogenerated/qlik-styles.css",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}});var u=document.createElement("script");return u.src="https://"+n+"/resources/assets/external/requirejs/require.js",u.onload=function(){try{return window.require.config({baseUrl:"https://"+n+"/resources",webIntegrationId:o}),Promise.resolve()}catch(e){return Promise.reject(e)}},document.body.appendChild(u),u.loaded=new Promise(function(e){u.onload=function(){e()}}),Z=Promise.all([i.loaded,u.loaded]),Promise.resolve(Z).then(function(){})}var n=function(){if(Z)return Promise.resolve(Z).then(function(){t=1})}();return n&&n.then?n.then(r):r(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(){window.require.config({baseUrl:"https://"+t.host+"/resources",webIntegrationId:e.webIntId}),window.require(["js/qlik"],function(e){try{var r=e.openApp(t.appId,t);return r.theme.get().then(function(e){e.apply()}),n(r),Promise.resolve(1)}catch(e){return Promise.reject(e)}})})},function(e){throw new Error(e)})}oe(function(){return Promise.resolve(function(e){try{var t;return Promise.resolve(oe(function(){function r(r){if(t)return r;var n=document.createElement("script"),o=""!==e.prefix?"/"+e.prefix:"";n.src=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/assets/external/requirejs/require.js",document.head.appendChild(n),n.loaded=new Promise(function(e){n.onload=function(){e()}});var i=document.createElement("link");return i.href=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/autogenerated/qlik-styles.css",i.type="text/css",i.rel="stylesheet",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}}),J=Promise.all([n.loaded,i.loaded]),Promise.resolve(J).then(function(){})}var n=function(){if(J)return Promise.resolve(J).then(function(){t=1})}();return n&&n.then?n.then(r):r(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(e)).then(function(){var t=""!==e.prefix?"/"+e.prefix+"/":"/";return window.require.config({baseUrl:(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+t+"resources",paths:{qlik:(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+t+"resources/js/qlik"},config:{text:{useXhr:function(){return!0}}}}),new Promise(function(r){if(ne.globals.qlik){var o=ne.globals.qlik.openApp(e.appId,p({},e,{isSecure:e.secure,prefix:t}));o.theme.get().then(function(e){e.apply()}),n(o)}else window.require(["js/qlik"],function(r){ne.globals.qlik=r,ne.globals.resize=function(){r.resize()};var o=r.openApp(e.appId,p({},e,{isSecure:e.secure,prefix:t}));return n(o),1})})})},function(e){throw new Error(e)})}()}catch(e){Promise.reject(e)}}()},[]),n=r[1];return{app:r[0]}},e.useData=function(e){var r,n=j(_,e),o=n.cols,i=n.qLists,u=n.qTitle,s=n.qSubTitle,a=n.qMetrics,c=n.qHyperCubeDef,l=n.qPage,q=n.qSortByAscii,f=n.qSortByLoadOrder,h=n.qInterColumnSortOrder,m=n.qSuppressZero,y=n.qSortByNumeric,b=n.qSortByExpression,v=n.qSuppressMissing,C=n.qExpression,g=n.qColumnOrder,S=n.qCalcCondition,P=n.getQRData,D=n.qOtherTotalSpec,x=t.useRef(!0),k=t.useReducer(V,H),L=k[0],I=k[1],T=L.title,O=L.subTitle,E=L.metrics,F=L.qData,w=L.mData,K=L.nameKey,U=L.valueKey,G=L.qListData,J=L.dataList,Z=L.dataKeys,Q=L.qRData,X=L.qLayout,$=L.selections,Y=(t.useContext(d)||{}).engine,ee=t.useRef(null),te=t.useRef(l),re=t.useState()[1],ne=t.useState(te.current.qHeight)[0];"object"==typeof D?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:D.qOtherCount}:D?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:D||(r={qOtherMode:"OTHER_OFF",qOtherCounted:""});var oe=t.useCallback(function(){var e={qInfo:{qType:"visualization"}};if(a&&a.map(function(t){var r;e[t.qName]=((r={})[t.qType?t.qType:"qValueExpression"]={qExpr:t.qExpr},r)}),i&&(e.qListObjects=[],i.map(function(t){var r={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:[Object.values(t)[0]],qFieldLabels:[Object.keys(t)[0]],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};e.qListObjects.push(r)})),c){var t=c;return o&&o[1]&&(t.qMeasures[0].qDef={qDef:o[1]}),o&&o[0]&&(t.qDimensions[0].qDef.qFieldDefs=[o[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=t,e}var n=h||[],s=!!h,l=0,d=o&&o.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return r&&!s&&(n[t]=l,l+=1),r}).map(function(e){if("string"==typeof e)return{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:q,qSortByLoadOrder:f}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0};if("object"==typeof e&&!e.qLibraryId){var t=[];if(e.qAttributeExpressions)for(var n=0,o=Object.entries(e.qAttributeExpressions);n<o.length;n++){var i=o[n];t.push({id:i[0],qExpression:i[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:f,qSortByAscii:q}]},qOtherTotalSpec:r,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:t,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}if("object"==typeof e&&e.qLibraryId){var u=[];if(e.qAttributeExpressions)for(var s=0,a=Object.entries(e.qAttributeExpressions);s<a.length;s++){var c=a[s];u.push({id:c[0],qExpression:c[1],qLibraryId:"",qAttribute:!1})}return{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:r,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:u,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}return e});if(d&&d.length>1){var p={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:d[1].qDef.qFieldDefs,qFieldLabels:["multiDimDataKeys"],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};void 0===e.qListObjects&&(e.qListObjects=[]),e.qListObjects.push(p)}var P=o&&o.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return r&&!s&&(n[t]=l,l+=1),r}).map(function(e){if("string"==typeof e)return{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:C,qSuppressMissing:v}};if("object"==typeof e){var t=[];if(e.qAttributeExpressions)for(var r=0,n=Object.entries(e.qAttributeExpressions);r<n.length;r++){var o=n[r];t.push({id:o[0],qExpression:o[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:C,qSuppressMissing:v},qAttributeExpressions:t}}return e});return e.qHyperCubeDef={qDimensions:d,qMeasures:P,qInterColumnSortOrder:h,qSuppressZero:m,qSuppressMissing:v,qColumnOrder:g,qCalcCondition:S,qTitle:u},e},[o,u,C,c,h,q,b,f,v,m]),ie=t.useCallback(function(){return ee.current.getLayout()},[]),ue=t.useCallback(function(){try{return Promise.resolve(A(function(){return Promise.resolve(ee.current.getHyperCubeData("/qHyperCubeDef",[te.current])).then(function(e){return e[0]})},function(e){re(e)}))}catch(e){return Promise.reject(e)}},[]),se=t.useCallback(function(e){try{var t=ee.current,r=te.current,n=null,o=[];return Promise.resolve(A(function(){function i(){return{qTails:n[0].qTails,qMatrix:o,qArea:n[0].qArea}}var u=0,s=function(e,t,r){for(var n;;){var o=e();if(z(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!z(i)){n=1;break}i=i.s}if(t){var u=t();if(u&&u.then&&!z(u)){n=2;break}}}var s=new W,a=M.bind(null,s,2);return(0===n?o.then(l):1===n?i.then(c):u.then(q)).then(void 0,a),s;function c(n){i=n;do{if(t&&(u=t())&&u.then&&!z(u))return void u.then(q).then(void 0,a);if(!(o=e())||z(o)&&!o.v)return void M(s,1,i);if(o.then)return void o.then(l).then(void 0,a);z(i=r())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,a)}function l(e){e?(i=r())&&i.then?i.then(c).then(void 0,a):c(i):M(s,1,i)}function q(){(o=e())?o.then?o.then(l).then(void 0,a):l(o):M(s,1,i)}}(function(){return u<e},function(){return u++},function(){return r=p({},r,{qTop:1e3*u}),Promise.resolve(t.getHyperCubeData("/qHyperCubeDef",[r])).then(function(e){o.push.apply(o,(n=e)[0].qMatrix)})});return s&&s.then?s.then(i):i()},function(e){re(e)}))}catch(e){return Promise.reject(e)}},[]),ae=t.useCallback(function(e){try{return Promise.resolve(ee.current.getListObjectData("/qListObjects/"+e+"/qListObjectDef",[te.current]))}catch(e){return Promise.reject(e)}}),ce=t.useCallback(function(e){try{return e.qListObjects?Promise.resolve(Promise.all(e.qListObjects.map(function(e,t){try{return Promise.resolve(ae(t))}catch(e){return Promise.reject(e)}}))):Promise.resolve()}catch(e){return Promise.reject(e)}},[]),le=t.useCallback(function(e){try{return Promise.resolve(0===e.qHyperCube.qDimensionInfo.length?null:e.qHyperCube.qDimensionInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),qe=t.useCallback(function(e){try{return Promise.resolve(0===e.qHyperCube.qMeasureInfo.length?null:e.qHyperCube.qMeasureInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),fe=t.useCallback(function(){return function(){try{var e=te.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(ee.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),de=t.useCallback(function(e,t){try{if(0===e.qHyperCube.qDimensionInfo.length&&0===e.qHyperCube.qMeasureInfo.length||!t)return Promise.resolve();var r=1===e.qHyperCube.qDimensionInfo.length?function(e,t,r){var n=void 0!==t?t.qDimensionInfo.length:1,o=N(t),i=R(t);return e.qMatrix.map(function(e,u){var s={},a={};return e.forEach(function(c,l){var q,f;if(l<n){var d=e[l].qAttrExps;void 0!==d&&d.qValues.forEach(function(e,r){void 0!==e.qText&&(a[t.qDimensionInfo[l].qAttrExprInfo[r].id]="NaN"!==e.qNum?e.qNum:e.qText)})}else{var h=e[l].qAttrExps;void 0!==h&&h.qValues.forEach(function(e,r){void 0!==e.qText&&(a[t.qMeasureInfo[l- -n].qAttrExprInfo[r].id]="NaN"!==e.qNum?e.qNum:e.qText)})}var m=l<n?((q={})[i[l]]=e[l].qText,q["elemNumber"+(0!==l?l:"")]=e[l].qElemNumber,q.key=u,q.label=e[l].qText,q):((f={})[o[l-n]]=r[l].qNumFormat||r[l].qNumType||r[l].qNumFmt?e[l].qText:"NaN"!==e[l].qNum?e[l].qNum:0,f.key=u,f);s=p({},s,m,a)}),s})}(t,e.qHyperCube,o):function(e,t){var r=void 0!==t?t.qDimensionInfo.length:1;N(t);var n=R(t),o=e.qMatrix[0][0].qText,i=[],u={};return e.qMatrix.map(function(e,t){var s=null,a=null,c=null;e.forEach(function(t,n){n<r&&0!==n?(s=e[n].qText,c=e[n].qElemNumber):0!==n&&(a=e[n].qNum)}),o!==e[0].qText?(0===Object.keys(u).length&&(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c),i.push(u),u={}):(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c,u.label=e[0].qText),o=e[0].qText}),i.push(u),i}(t,e.qHyperCube);return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[]),pe=t.useCallback(function(e,t){try{if(!e)return Promise.resolve(t.map(function(e){return e.qFallbackTitle}));var r=e.filter(function(e){return"multiDimDataKeys"===Object.keys(e)[0]});return Promise.resolve(r[0].multiDimDataKeys)}catch(e){return Promise.reject(e)}},[]),he=t.useCallback(function(e,t){try{var r=[];return t.qListObjects?(t.qListObjects.map(function(t,n){var o={},i=t.qListObject.qDimensionInfo.qFallbackTitle,u=e[n][0]?e[n][0].qMatrix.map(function(e){return e[0].qText}):null;o[i]=u,r.push(o)}),Promise.resolve(r)):Promise.resolve(null)}catch(e){return Promise.reject(e)}},[]),me=t.useCallback(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),ye=t.useCallback(function(e,t){try{if(!t)return Promise.resolve();var r={};return t.map(function(t){r[t.qName]=e[t.qName]}),Promise.resolve(r)}catch(e){return Promise.reject(e)}},[]),be=t.useCallback(function(){try{return Promise.resolve(ie()).then(function(e){return Promise.resolve(B(e)).then(function(t){return Promise.resolve(Math.ceil(e.qHyperCube.qSize.qcy/ne)<=1?ue():se(Math.ceil(e.qHyperCube.qSize.qcy/ne))).then(function(t){return Promise.resolve(ce(e)).then(function(r){return Promise.resolve(de(e,t)).then(function(n){return Promise.resolve(le(e)).then(function(o){return Promise.resolve(qe(e)).then(function(i){return Promise.resolve(he(r,e)).then(function(u){return Promise.resolve(pe(u,e.qHyperCube.qMeasureInfo)).then(function(c){return Promise.resolve(me(e)).then(function(l){var q=s;return Promise.resolve(ye(e,a)).then(function(s){if(t&&x.current){var a=t.qMatrix.filter(function(e){return"S"===e[0].qState});I({type:"update",payload:{title:l,subTitle:q,qData:t,mData:n,nameKey:o,valueKey:i,qListData:r,dataList:u,dataKeys:c,metrics:s,qLayout:e,selections:a}})}else x.current&&I({type:"update",payload:{title:l,subTitle:q,metrics:s,qData:t,mData:n,nameKey:o,valueKey:i,qListData:r,dataList:u,dataKeys:c,qLayout:e}});var f=function(){if(P)return Promise.resolve(fe()).then(function(e){x.current&&I({type:"updateReducedData",payload:{qRData:e}})})}();if(f&&f.then)return f.then(function(){})})})})})})})})})})})})}catch(e){return Promise.reject(e)}},[ue,ie,P,fe]),ve=t.useCallback(function(e){te.current=p({},te.current,e),be()},[be]),Ce=t.useCallback(function(){return ee.current.beginSelections(["/qHyperCubeDef"])},[!0]),ge=t.useCallback(function(e){return ee.current.endSelections(e)},[]),Se=t.useCallback(function(e,t,r){return void 0===r&&(r=!1),ee.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),Pe=t.useCallback(function(e){return ee.current.applyPatches(e)},[]),De=t.useCallback(function(e,t){try{return Promise.resolve(Pe([{qOp:"replace",qPath:"/qHyperCubeDef/"+(e?"qMeasures":"qDimensions")+"/0/qDef/"+(e?"qDef":"qFieldDefs"),qValue:JSON.stringify(e?t:[t])}])).then(function(){})}catch(e){return Promise.reject(e)}},[Pe,X]);t.useEffect(function(){if(Y&&!ee.current)try{var e=oe();return Promise.resolve(Y).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){ee.current=t,ee.current.on("changed",function(){be(e.qHyperCubeDef.qMeasures)}),be(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[oe,Y,be]),t.useEffect(function(){return function(){return x.current=!1}},[]);var xe={};return w&&(xe.data=w),w&&(xe.select=Se),Z&&0!==Z.length&&(xe.dataKeys=Z),J&&(xe.dataList=J),K&&(xe.nameKey=K),U&&(xe.valueKey=U),{beginSelections:Ce,endSelections:ge,qLayout:X,qData:F,mData:w,qListData:G,dataList:J,handlerChange:De,dataKeys:Z,nameKey:K,dataSet:xe,title:T,subTitle:O,metrics:E,qRData:Q,changePage:ve,selections:$,select:Se,applyPatches:Pe}},e.useEngine=D,e.useGlobal=function(e){var r=[{onRejected:function(e,t,r){return console.warn("Captured Request: Rejected","Error Code: "+r.code+" : "+r),r.code===$.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(t.tries=(t.tries||0)+1,console.warn("Captured Request: Retry #"+t.tries),t.tries<=3)?t.retry():r.code===$.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||r.code===$.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?r.code:(console.warn(r),this.Promise.reject(r))}}],n=t.useState(!1),o=n[0],i=n[1],u=t.useState(null),s=u[0],a=u[1],c=t.useState(function(){!function(){try{var t,n=function(n){return t?n:function(){if(e){var t=Y.buildUrl(e);return function(e,n){try{var o=((i=X.create({schema:$,url:t,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),i.on("error",function(){console.warn("Captured session error")}),i.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(i.open()).then(function(e){return Promise.resolve(e.engineVersion()).then(function(t){return Promise.resolve(e.getDocList({})).then(function(r){return Promise.resolve(e.oSName()).then(function(n){return Promise.resolve(e.oSVersion()).then(function(o){return l({global:e,docList:r,engineVersion:t,oSName:n,oSVersion:o}),a(1),1})})})})}))}catch(e){return n(e)}var i;return o&&o.then?o.then(void 0,n):o}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(e&&e.qcs){var n=e.host,o=e.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),t=1,-1;var s=X.create({schema:$,url:"wss://"+n+"/app/"+e.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(e){return Promise.resolve(e.engineVersion()).then(function(r){return Promise.resolve(e.getDocList({})).then(function(n){return Promise.resolve(e.oSName()).then(function(o){return Promise.resolve(e.oSVersion()).then(function(i){return l({global:e,docList:n,engineVersion:r,oSName:o,oSVersion:i}),a(1),t=1})})})})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return p({},c[0],{globalError:o,errorCode:s})},e.useHyperCube=function(e){var r,n=j(O,e),o=n.cols,i=n.qHyperCubeDef,u=n.qPage,s=n.qSortByAscii,a=n.qSortByLoadOrder,c=n.qInterColumnSortOrder,l=n.qSuppressZero,q=n.qSortByNumeric,f=n.qSortByExpression,h=n.qSuppressMissing,m=n.qExpression,y=n.qColumnOrder,b=n.qCalcCondition,v=n.getQRData,C=n.qOtherTotalSpec,g=t.useRef(!0),S=t.useReducer(T,I),P=S[0],D=S[1],x=P.qData,k=P.qRData,L=P.qLayout,E=P.selections,F=(t.useContext(d)||{}).engine,w=t.useRef(null),N=t.useRef(u);"object"==typeof C?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:C.qOtherCount}:C?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:C||(r={qOtherMode:"OTHER_OFF",qOtherCounted:""});var R=t.useCallback(function(){var e={qInfo:{qType:"visualization"}};if(i){var t=i;return o&&o[1]&&(t.qMeasures[0].qDef={qDef:o[1]}),o&&o[0]&&(t.qDimensions[0].qDef.qFieldDefs=[o[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=t,e}var n=c||[],u=!!c,d=0,p=o.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return r&&!u&&(n[t]=d,d+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:s,qSortByLoadOrder:a}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:r,qOtherLabel:void 0!==C?C.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:a,qSortByAscii:s}]},qOtherTotalSpec:r,qOtherLabel:void 0!==C?C.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),v=o.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return r&&!u&&(n[t]=d,d+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:q,qSortByExpression:f,qExpression:m,qSuppressMissing:h}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:q,qSortByExpression:f,qExpression:m,qSuppressMissing:h},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return e.qHyperCubeDef={qDimensions:p,qMeasures:v,qInterColumnSortOrder:c,qSuppressZero:l,qSuppressMissing:h,qColumnOrder:y,qCalcCondition:b},e},[o,m,i,c,s,f,a,h,l]),B=t.useCallback(function(){return w.current.getLayout()},[]),A=t.useCallback(function(){try{return Promise.resolve(w.current.getHyperCubeData("/qHyperCubeDef",[N.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),H=t.useCallback(function(){return function(){try{var e=N.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(w.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),M=t.useCallback(function(e){try{return Promise.resolve(B()).then(function(t){return Promise.resolve(A()).then(function(r){if(r&&g.current){var n=r.qMatrix.filter(function(e){return"S"===e[0].qState});e&&e.map(function(e,r){t.qHyperCube.qMeasureInfo[r]&&(t.qHyperCube.qMeasureInfo[r].qChartType=e.qChartType,t.qHyperCube.qMeasureInfo[r].qShowPoints=e.qShowPoints,t.qHyperCube.qMeasureInfo[r].qCurve=e.qCurve,t.qHyperCube.qMeasureInfo[r].qFillStyle=e.qFillStyle,t.qHyperCube.qMeasureInfo[r].qLegendShape=e.qLegendShape)}),D({type:"update",payload:{qData:r,qLayout:t,selections:n}})}else g.current&&D({type:"update",payload:{qData:r,qLayout:t}});var o=function(){if(v)return Promise.resolve(H()).then(function(e){g.current&&D({type:"updateReducedData",payload:{qRData:e}})})}();if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},[A,B,v,H]),W=t.useCallback(function(e){N.current=p({},N.current,e),M()},[M]),z=t.useCallback(function(){return w.current.beginSelections(["/qHyperCubeDef"])},[!0]),V=t.useCallback(function(e){return w.current.endSelections(e)},[]),_=t.useCallback(function(e,t,r){return void 0===r&&(r=!1),w.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),K=t.useCallback(function(e){return w.current.applyPatches(e)},[]);return t.useEffect(function(){if(F&&!w.current)try{var e=R();return Promise.resolve(F).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){w.current=t,w.current.on("changed",function(){M(e.qHyperCubeDef.qMeasures)}),M(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[R,F,M]),t.useEffect(function(){return function(){return g.current=!1}},[]),{beginSelections:z,endSelections:V,qLayout:L,qData:x,qRData:k,changePage:W,selections:E,select:_,applyPatches:K}},e.useLayout=function(){var e=(t.useContext(d)||{}).engine,r=t.useState(null),n=r[0],o=r[1],i=t.useState(null),u=i[0],s=i[1];return t.useEffect(function(){return function(){try{if(!e)return Promise.resolve();var t=function(t,r){try{var n=Promise.resolve(e).then(function(e){return Promise.resolve(e.getAppLayout()).then(function(e){o(p({appLayout:e},e))})})}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}(0,function(e){s(e)});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[e]),p({},n,{error:u})},e.useList=function(e){var r=j(w,e),n=r.qPage,o=r.dimension,i=r.qListObjectDef,u=r.qSortByAscii,s=r.qSortByLoadOrder,a=r.autoSortByState,c=(t.useContext(d)||{}).engine,l=t.useRef(!0),q=t.useReducer(F,E),f=q[0],h=q[1],m=f.listData,y=f.selections,b=f.selectionsId,v=t.useRef(null),C=t.useRef(n),g=t.useCallback(function(e){void 0===e&&(e=0);var t={qInfo:{qType:"visualization"}};if(i)t.qListObjectDef=i;else{var r=o.filter(function(e){return"string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByLoadOrder:s,qSortByAscii:u}]}}:e});t.qListObjectDef=p({},{qLibraryId:"object"==typeof o[0]&&o[0].qLibraryId?o[0].qLibraryId:""},r[e],{qShowAlternatives:!0,qAutoSortByState:{qDisplayNumberOfRows:a}})}return t},[a,o,i,u,s]),S=t.useCallback(function(){try{return Promise.resolve(v.current.getListObjectData("/qListObjectDef",[C.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),P=t.useCallback(function(e){try{if(!m){if(!e)return Promise.resolve(null);var t=[];e.qMatrix.map(function(e,r){t.push({key:e[0].qElemNumber,text:void 0!==e[0].qText?e[0].qText:"undefined",number:e[0].qNumber,state:e[0].qState,value:void 0!==e[0].qText?e[0].qText:"undefined",label:void 0!==e[0].qText?e[0].qText:"undefined"})});var r=t&&t.filter(function(e){return"S"===e.state}),n=r&&r.map(function(e){return e.key});return Promise.resolve({_selId:n,_selections:r,_listData:t})}return Promise.resolve()}catch(e){return Promise.reject(e)}},[m]),D=t.useCallback(function(){try{return Promise.resolve(S()).then(function(e){return Promise.resolve(P(e)).then(function(t){var r=t._listData;e&&l.current?h({type:"update",payload:{listData:r,selections:t._selections,selectionsId:t._selId}}):l.current&&h({type:"update",payload:{listData:r}})})})}catch(e){return Promise.reject(e)}},[S,P]),x=t.useCallback(function(e){C.current=p({},C.current,e),D()},[D]),k=t.useCallback(function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=!1),v.current.selectListObjectValues("/qListObjectDef",e,t,r)},[]),L=t.useCallback(function(e){return v.current.searchListObjectFor("/qListObjectDef",e)},[]),I=t.useCallback(function(e){return void 0===e&&(e=!1),v.current.acceptListObjectSearch("/qListObjectDef",!0,e)},[]),T=t.useCallback(function(e){return v.current.applyPatches(e)},[]),O=t.useCallback(function(){return v.current.clearSelections("/qListObjectDef")},[]);return t.useEffect(function(){if(c&&!v.current)try{var e=g();return Promise.resolve(c).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(e){v.current=e,l.current&&h({type:"init",payload:{qDoc:t}}),v.current.on("changed",function(){D()}),D()})})}catch(e){Promise.reject(e)}},[g,c,D]),t.useEffect(function(){return function(){return l.current=!1}},[]),{listData:m,changePage:x,select:k,beginSelections:function(){try{return Promise.resolve(f.qDoc.abortModal(!0)).then(function(){return Promise.resolve(v.current.beginSelections(["/qListObjectDef"])).then(function(){})})}catch(e){return Promise.reject(e)}},endSelections:function(e){try{return Promise.resolve(v.current.endSelections(e)).then(function(){})}catch(e){return Promise.reject(e)}},searchListObjectFor:L,acceptListObjectSearch:I,applyPatches:T,selections:y,selectionsId:b,clearSelections:O,motorListProps:{clearSelections:O,selections:y,select:k}}},e.useSearch=function(e){var r=e.searchValue,n=e.dimensions,o=e.qCount,i=e.qGroupItemCount,u=t.useState([]),s=u[0],a=u[1],c=t.useState([]),l=c[0],q=c[1],f=t.useRef(!0),p=(t.useContext(d)||{}).engine;t.useEffect(function(){void 0===p||function(){try{var e=function(e,t){try{var u=Promise.resolve(p).then(function(e){return Promise.resolve(e.searchResults({qSearchFields:n},[r],{qOffset:0,qCount:o,qGroupItemOptions:[{qGroupItemType:"FIELD",qOffset:0,qCount:i}]})).then(function(e){return Promise.resolve(e).then(function(e){return Promise.resolve(h(e)).then(function(e){return Promise.resolve(m(e)).then(function(t){a(e),q(t),f.current&&(a(e),q(t))})})})})})}catch(e){return t(e)}return u&&u.then?u.then(void 0,t):u}(0,function(e){console.warn(e)});e&&e.then&&e.then(function(){})}catch(e){Promise.reject(e)}}()},[p,r,o,i,n]),t.useEffect(function(){return function(){return f.current=!1}},[]);var h=function(e){var t=[],r={};return e.qSearchGroupArray.map(function(e){r.id=e.qId,r.dimension=e.qItems[0].qIdentifier,r.value=e.qItems[0].qItemMatches,t.push(r),r={}}),t},m=function(e){var t=[],r={};return e.map(function(e){e.value.map(function(n){r.dimension=e.dimension,r.value=n.qText,t.push(r),r={}})}),t},y=t.useCallback(function(e){return function(){try{return Promise.resolve(p).then(function(t){t.selectAssociations({qSearchFields:n,qContext:"CurrentSelections"},[r],e)})}catch(e){return Promise.reject(e)}}()});return{groupResults:s,flatResults:l,flatSelect:t.useCallback(function(e,t){return function(){try{return Promise.resolve(p).then(function(r){return Promise.resolve(r.getField(e)).then(function(e){e.select(t)})})}catch(e){return Promise.reject(e)}}()}),groupSelect:y}},e.useSelections=function(){var e=(t.useContext(d)||{}).engine,r=t.useRef(!0),n=t.useState(null),o=n[0],i=n[1],u=t.useState(null),s=u[0],a=u[1],c=t.useCallback(function(){try{return Promise.resolve(re.getLayout()).then(function(e){return Promise.resolve(l(e)).then(function(t){r.current&&(i(e),a(t))})})}catch(e){return Promise.reject(e)}},[]),l=function(e){return e.qSelectionObject.qSelections};return t.useEffect(function(){if(void 0===e);else try{var t={qInfo:{qType:"SelectionObject"},qSelectionObjectDef:{}};return Promise.resolve(e).then(function(e){return te=e,Promise.resolve(te.createSessionObject(t)).then(function(e){(re=e).on("changed",function(){c()}),c()})})}catch(e){Promise.reject(e)}},[e,c]),t.useEffect(function(){return function(){return r.current=!1}},[]),{qLayout:o,selections:s,clearSelections:function(e,t){try{var r=function(){if(e)return Promise.resolve(te.getField(e)).then(function(e){var r=t?Promise.resolve(e.toggleSelect(t)).then(function(){}):Promise.resolve(e.clear()).then(function(){});if(r&&r.then)return r.then(function(){})});te.clearAll()}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}}},e.useTable=function(e){var r=j(Q,e),n=r.cols,o=r.qTitle,i=r.qHyperCubeDef,u=r.qPage,s=r.sortCriteria,a=r.qSuppressZero,c=r.qSuppressMissing,l=r.qColumnOrder,q=r.qCalcCondition,f=r.getQRData,h=r.qOtherTotalSpec,m=t.useRef(!0),y=t.useReducer(G,U),b=y[0],v=y[1],C=s.qInterColumnSortOrder,g=s.qSortByAscii,S=s.qSortByLoadOrder,P=s.qExpression,D=s.qSortByNumeric,x=s.qSortByExpression,k=b.title,L=b.qData,I=b.dataSet,T=b.qRData,O=b.headerGroup,E=b.qLayout,F=b.selections,w=(t.useContext(d)||{}).engine,N=t.useRef(null),R=t.useRef(u),A=t.useState()[1],H=t.useState(R.current.qHeight)[0],M=t.useState(0),W=M[0],z=M[1],V=t.useCallback(function(e){z(e),se({qTop:e*H})},[se,H]);window.setPage=V;var _,J=t.useState(0),Z=J[0],X=J[1],$=t.useCallback(function(e){W>=e&&V(0),X(e)},[W,V]),Y=t.useCallback(function(e){V(e)},[V]);t.useEffect(function(){E&&L&&$(Math.ceil(E.qHyperCube.qSize.qcy/H))},[E,L,H,V,$]),"object"==typeof h?_={qOtherMode:"OTHER_COUNTED",qOtherCounted:h.qOtherCount}:h?_={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:h||(_={qOtherMode:"OTHER_OFF",qOtherCounted:""});var ee=t.useCallback(function(){return K(n,o,i,g,S,C,a,D,x,c,P,l,q,h,_)},[n,o,P,i,C,g,x,S,c,h,a]),te=t.useCallback(function(){return N.current.getLayout()},[]),re=t.useCallback(function(){try{return Promise.resolve(function(e,t){try{var r=Promise.resolve(N.current.getHyperCubeData("/qHyperCubeDef",[R.current])).then(function(e){return e[0]})}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(0,function(e){A(e)}))}catch(e){return Promise.reject(e)}},[]),ne=t.useCallback(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),oe=t.useCallback(function(){return function(){try{var e=R.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(N.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),ie=t.useCallback(function(e,t,r){try{var n=function(e,t,r){return e.qMatrix.map(function(e,t){var n={};return e.forEach(function(o,i){var u,s=((u={})[r[i].dataKey]={text:e[i].qText,number:e[i].qNum,elemNumber:e[i].qElemNumber,state:e[i].qState,attrExp:e[i].qAttrExps,columnId:i},u.key=t,u);n=p({},n,s)}),n})}(t,0,r);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},[]),ue=t.useCallback(function(){try{return Promise.resolve(te()).then(function(e){return Promise.resolve(ne(e)).then(function(t){return Promise.resolve(B(e)).then(function(r){return Promise.resolve(re()).then(function(r){return Promise.resolve(function(e){var t=[],r=[];return function(e){e.filter(function(e,t){return"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=")}).map(function(e){return t.push(e),e})}(e),function(e){e.filter(function(e,t){return"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=")}).map(function(e){return r.push(e),e})}(e),t.concat(r)}(n)).then(function(n){function o(o){function i(n){if(r&&m.current){var i=r.qMatrix.filter(function(e){return"S"===e[0].qState});v({type:"update",payload:{title:t,qData:r,dataSet:o,headerGroup:n,qLayout:e,selections:i}})}else m.current&&v({type:"update",payload:{title:t,qData:r,dataSet:o,headerGroup:n,qLayout:e}});var u=function(){if(f)return Promise.resolve(oe()).then(function(e){m.current&&v({type:"updateReducedData",payload:{qRData:e}})})}();if(u&&u.then)return u.then(function(){})}return r?Promise.resolve(function(e,t,r){return e?[].concat(e.qHyperCube.qDimensionInfo.map(function(e,r){return{title:e.qFallbackTitle,dataIndex:t[r].dataKey,dataKey:t[r].dataKey,render:t[r].render,defaultSortDesc:"D"===e.qSortIndicator,qInterColumnIndex:r,qPath:"/qHyperCubeDef/qDimensions/"+r,qSortIndicator:e.qSortIndicator,qReverseSort:e.qReverseSort,qGrandTotals:{qText:null,qNum:null},qColumnType:"dim"}}),e.qHyperCube.qMeasureInfo.map(function(r,n){return{title:r.qFallbackTitle,dataIndex:t[e.qHyperCube.qDimensionInfo.length+n].dataKey,dataKey:t[e.qHyperCube.qDimensionInfo.length+n].dataKey,render:t[e.qHyperCube.qDimensionInfo.length+n].render,defaultSortDesc:"D"===r.qSortIndicator,qInterColumnIndex:n+e.qHyperCube.qDimensionInfo.length,qPath:"/qHyperCubeDef/qMeasures/"+n,qSortIndicator:r.qSortIndicator,qReverseSort:r.qReverseSort,qGrandTotals:e.qHyperCube.qGrandTotalRow[n],qColumnType:"meas"}})):[]}(e,n)).then(i):i(r)}return r?Promise.resolve(ie(e,r,n)).then(o):o(r)})})})})})}catch(e){return Promise.reject(e)}},[re,te,f,oe]),se=t.useCallback(function(e){R.current=p({},R.current,e),ue()},[ue]),ae=t.useCallback(function(){return N.current.beginSelections(["/qHyperCubeDef"])},[!0]),ce=t.useCallback(function(e){return N.current.endSelections(e)},[]),le=t.useCallback(function(e,t,r){return void 0===r&&(r=!1),N.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),qe=t.useCallback(function(e){return N.current.applyPatches(e)},[]),fe=t.useCallback(function(e){try{var t=function(){return Promise.resolve(qe([{qOp:"replace",qPath:e.qPath+"/qDef/qReverseSort",qValue:JSON.stringify(!e.qReverseSort)},{qOp:"replace",qPath:"/qHyperCubeDef/qInterColumnSortOrder",qValue:JSON.stringify([].concat(E.qHyperCube.qEffectiveInterColumnSortOrder).sort(function(t,r){return t===e.qInterColumnIndex?-1:r===e.qInterColumnIndex?1:0}))}])).then(function(){V(0)})},r=function(){if("N"===e.qSortIndicator){var t=function(){var t=function(){if(e.qPath.includes("qMeasures"))return Promise.resolve(qe([{qOp:"add",qPath:e.qPath+"/qSortBy",qValue:JSON.stringify({qSortByLoadOrder:1})}])).then(function(){})}();if(t&&t.then)return t.then(function(){})},r=function(){if(e.qPath.includes("qDimensions"))return Promise.resolve(qe([{qOp:"add",qPath:e.qPath+"/qDef/qSortCriterias",qValue:JSON.stringify([{qSortByLoadOrder:1}])}])).then(function(){})}();return r&&r.then?r.then(t):t()}}();return Promise.resolve(r&&r.then?r.then(t):t())}catch(e){return Promise.reject(e)}},[qe,E]);return t.useEffect(function(){if(w&&!N.current)try{var e=ee();return Promise.resolve(w).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){N.current=t,N.current.on("changed",function(){ue(e.qHyperCubeDef.qMeasures)}),ue(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[ee,w,ue]),t.useEffect(function(){return function(){return m.current=!1}},[]),{beginSelections:ae,endSelections:ce,title:k,qLayout:E,qData:L,dataSet:I,headerGroup:O,handleSortChange:fe,qRData:T,changePage:se,selections:F,select:le,applyPatches:qe,incrementPage:function(){Y(W+1)},decrementPage:function(){Y(0==W?Z-1:W-1)},handlePageChange:Y,page:W,pageSize:H,pages:Z}},e.useVariable=function(e){var r="string"==typeof e?e:e.name||null,n=j(ue,e),o=n.id,i=n.comment,u=n.numberPresentation,s=n.includeInBookmark,a=n.definition,c=(t.useContext(d)||{}).engine,l=t.useState(null),q=l[0],f=l[1],h=t.useState(null),m=h[0],y=h[1],b=t.useState(null),v=b[0],C=b[1],g=t.useRef(null),S=function(e,t,r,n,o,i){return{qInfo:{qId:e,qType:"Variable"},qMetaDef:{},qName:t,qComment:r,qNumberPresentation:n,qIncludeInBookmark:o,qDefinition:i.toString()}},P=t.useCallback(function(){return g.current.getLayout()},[]),D=t.useCallback(function(){return g.current.getProperties()},[]),x=t.useCallback(function(e){try{var t=e.qId,r=e.qName,n=e.qComment,o=e.qNumberPresentation,i=e.qIncludeInBookmark,u=e.qDefinition,s=function(){if(g.current)return Promise.resolve(D()).then(function(e){return Promise.resolve(g.current.setProperties(S(t||e.qInfo.qId,r||e.qName,n||e.qComment,o||e.qNumberPresentation,i||e.qIncludeInBookmark,u.toString()||e.qDefinition.toString()))).then(function(e){L(e.current)})})}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),k=t.useCallback(function(e){try{var t=function(){if(g.current)return Promise.resolve(D()).then(function(t){return Promise.resolve(g.current.setProperties(S(t.qInfo.qId,t.qName,t.qComment,t.qNumberPresentation,t.qIncludeInBookmark,e.toString()))).then(function(e){L(e.current)})})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),L=t.useCallback(function(e){try{return Promise.resolve(P()).then(function(e){return e.value="number"===e.qNum?e.qNum:e.qText,f(e),Promise.resolve(D()).then(function(e){y(e)})})}catch(e){return Promise.reject(e)}},[]);return t.useEffect(function(){if(c)try{return Promise.resolve(c).then(function(e){var t=ie(function(){return Promise.resolve(function(e,t,r,n,o,i){try{return Promise.resolve(c).then(function(u){function s(){function s(){function s(){var s=function(){if(t&&i){var s=ie(function(){return Promise.resolve(u.getVariableByName({qName:t})).then(function(e){a=e})},function(s){function c(){(v.code=18001)?C("Variable already exists"):C(s)}var l=function(){if(!a)return Promise.resolve(u.createSessionVariable(S(e,t,r,n,o,i))).then(function(e){return a=e,Promise.resolve(a).then(function(e){g.current=e,L(g.current)})})}();return l&&l.then?l.then(c):c()});if(s&&s.then)return s.then(function(){})}}();return s&&s.then?s.then(function(){return a}):a}var c=function(){if(t&&!i)return Promise.resolve(u.getVariableByName({qName:t})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var c=function(){if(e&&!i)return Promise.resolve(u.getVariableById({qId:e})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var a,c=function(){if(!e&&!t&&!i)return Promise.resolve(u.createSessionObject({qInfo:{qId:"VL01",qType:"VariableList"},qVariableListDef:{qType:"variable"}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){f(a=e)})})}();return c&&c.then?c.then(s):s()})}catch(e){return Promise.reject(e)}}(o,r,i,u,s,a)).then(function(e){g.current=e,g.current.on("changed",function(){L(g.current)}),L(g.current)})},function(e){C(-2===e.code?"Variable Not Found":e)});if(t&&t.then)return t.then(function(){})})}catch(e){Promise.reject(e)}},[o,r,c]),q&&q.qVariableList&&(q.variableList=q.qVariableList.qItems),p({qLayout:q},q,{qProperties:m,setProperties:x,setValue:k,error:v})}});
//# sourceMappingURL=index.ts.map
