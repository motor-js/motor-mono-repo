var e=require("react"),t=require("react-watermark-component"),r=require("prop-types"),n=require("react/jsx-runtime"),o=require("crypto-js/aes"),i=require("crypto-js/enc-utf8");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=u(e),a=u(t),c=u(r),l=u(o),q=u(i),f=s.default.createContext();function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function p(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(r=i[n])>=0||(o[r]=e[r]);return o}var h,m=function(e){var t=e.config,r=e.header,o=e.body,i=e.bodySub,u=e.buttonText,s=e.buttonFontColor,a=e.buttonColor,c=e.logo,l=e.loginfontFamily,q=t.host,f=t.webIntId;return n.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[n.jsx("div",{style:{fontFamily:l,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:n.jsx("div",{size:e.size,style:{padding:"0.6rem",fontSize:"18px"},children:c?n.jsx("img",{src:c,height:e.logoHeight,width:e.logoWidth,alt:"Logo"}):r})}),n.jsxs("div",{style:{fontFamily:l,width:"100%",display:"flex",boxSizing:"border-box",padding:"0.8rem",WebkitAlignItems:"center",WebkitBoxAlign:"center",msFlexAlign:"center",alignItems:"center",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"column",msFlexDirection:"column",flexDirection:"column",WebkitFlex:"column",msFlex:"0 0 auto",flex:"0 0 auto"},children:[n.jsx("div",{style:{padding:"0.6rem",fontSize:"14px"},children:o}),n.jsx("div",{style:{padding:"0.6rem",fontSize:"14px"},children:i}),n.jsx("button",{style:{fontFamily:l,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:a,borderRadius:"8px",color:s,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){var e=new URL("https://"+q+"/login");e.searchParams.append("returnto",window.location.href),e.searchParams.append("qlik-web-integration-id",f),window.location.href=e},children:u})]})]})})},y=["config"],b=function(t){var r=t.config,o=p(t,y),i=e.useContext(f).errorCode;return n.jsx("div",{style:{display:-1===i?"":"none"},children:r&&i&&n.jsx(m,d({config:r},o))})};b.propTypes=((h={config:c.default.object,header:c.default.string,body:c.default.string,bodySub:c.default.string,size:c.default.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:c.default.string,backgroundColor:c.default.string,buttonFontColor:c.default.string,buttonColor:c.default.string,logo:c.default.string,logoHeight:c.default.string,logoWidth:c.default.string}).header=c.default.string,h.loginfontFamily=c.default.string,h),b.defaultProps={config:null,logo:null,logoHeight:null,logoWidth:null,header:"Welcome to your motor js mashup",body:"Please log on to access your application",bodySub:"",size:"medium",buttonText:"Login",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var v=function(e){var t=e.body,r=e.size,o=e.buttonText,i=e.buttonFontColor,u=e.buttonColor,s=e.loginfontFamily;return n.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:1040,width:"100vw",height:"100vh",backgroundColor:"rgba(105, 105, 105, 0.8)",display:"flex"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",position:"relative",margin:.2,padding:"5px",backgroundColor:e.backgroundColor,border:"1px solid gray",borderRadius:"8px",width:"30%",minWidth:"350px",top:"30%",left:"35%",alignSelf:"flex-start"},children:[n.jsx("div",{style:{fontFamily:s,width:"100%",display:"flex",boxSizing:"border-box",borderBottom:"solid 1px #ced4da",WebkitBoxPack:"center",WebkitJustifyContent:"center",msFlexPack:"center",justifyContent:"center",overflow:"visible",WebkitFlexDirection:"row",msFlexDirection:"row",flexDirection:"row",WebkitFlex:"0 0 auto",msFlex:"0 0 auto",flex:"0 0 auto"},children:n.jsx("div",{size:r,style:{padding:"0.8rem",fontSize:"16px"},children:e.header})}),n.jsxs("div",{focusable:!1,width:"100%",align:"center",direction:"column",padding:"0.8rem",children:[n.jsx("div",{size:r,style:{padding:"0.6rem",fontSize:"14px",fontFamily:s},children:t}),n.jsx("button",{style:{fontFamily:s,fontSize:"14px",cursor:"pointer",position:"relative",margin:"5px",backgroundColor:u,borderRadius:"8px",color:i,border:0,outline:"none",WebkitTransition:"none",transition:"none",padding:"0.7em 1.7em"},onClick:function(){return location.reload()},children:o})]})]})})},C=require("enigma.js"),g=require("enigma.js/schemas/12.170.2.json"),S=require("enigma.js/sense-utilities");function P(t){var r=[{onRejected:function(e,t,r){return console.warn("Captured Request: Rejected","Error Code: "+r.code+" : "+r),r.code===g.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(t.tries=(t.tries||0)+1,console.warn("Captured Request: Retry #"+t.tries),t.tries<=3)?t.retry():r.code===g.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||r.code===g.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?r.code:(console.warn(r),this.Promise.reject(r))}}],n=e.useState(!1),o=n[0],i=n[1],u=e.useState(null),s=u[0],a=u[1],c=e.useState(function(){!function(){try{var e,n=function(n){return e?n:function(){if(t){var e=S.buildUrl(t);return function(n,o){try{var i=((u=C.create({schema:g,url:e,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),u.on("error",function(){console.warn("Captured session error")}),u.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(u.open()).then(function(e){return Promise.resolve(e.openDoc(t.appId)).then(function(e){return l(e),a(1),1})}))}catch(e){return o(e)}var u;return i&&i.then?i.then(void 0,o):i}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(t&&t.qcs){var n=t.host,o=t.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),e=1,-1;var s=C.create({schema:g,url:"wss://"+n+"/app/"+t.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(r){return Promise.resolve(r.openDoc(t.appId)).then(function(t){return l(t),a(1),e=1})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return{engine:c[0],engineError:o,errorCode:s}}var D=["config"],x=function(t){var r=t.config,o=p(t,D),i=e.useContext(f),u=P(r),s=(i||u).errorCode;return n.jsx("div",{style:{display:-3===s?"":"none"},children:r&&s&&n.jsx(v,d({},o))})};x.propTypes={header:c.default.string,body:c.default.string,size:c.default.oneOf(["tiny","small","medium","large","xlarge"]),buttonText:c.default.string,backgroundColor:c.default.string,buttonFontColor:c.default.string,buttonColor:c.default.string,loginfontFamily:c.default.string},x.defaultProps={header:"Connection to server lost",body:"Please reload the page to refresh the dashboard",size:"medium",buttonText:"Reload Page",backgroundColor:"white",buttonFontColor:"white",buttonColor:"#ff6961",loginfontFamily:"Inter,sans-serif"};var k=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},L=function e(t){var r=[].slice.call(arguments,1);if(!r.length)return t;var n=d({},t);return r.forEach(function(t){k(t)&&Object.keys(t).forEach(function(r){n[r]=k(t[r])?n[r]?e(n[r],t[r]):d({},t[r]):t[r]})}),n},j={qData:null,qRData:null,qLayout:null,selections:null};function I(e,t){var r=t.payload,n=r.qData,o=r.qRData,i=r.qLayout,u=r.selections;switch(t.type){case"update":return d({},e,{qData:n,qLayout:i,selections:u});case"updateReducedData":return d({},e,{qRData:o});default:throw new Error}}var T={cols:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},O={qDoc:null,qObject:null,qData:null,listData:null,selections:null,selectionsId:null};function E(e,t){var r=t.payload,n=r.qData,o=r.listData,i=r.selections,u=r.selectionsId,s=r.qDoc;switch(t.type){case"update":return d({},e,{qData:n,listData:o,selections:i,selectionsId:u});case"init":return d({},e,{qDoc:s});default:throw new Error}}var F={autoSortByState:1,qSortByAscii:1,qSortByLoadOrder:1,dimension:null,label:null,qListObjectDef:null,qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e4}},w=function(e){return e.qMeasureInfo.map(function(e,t){return e.qFallbackTitle})},N=function(e){return e.qDimensionInfo.map(function(e,t){return e.qFallbackTitle})},R=function(e){var t=e.qHyperCube||e.qListObject,r=t.qDimensionInfo,n=t.qMeasureInfo,o=function(){(Array.isArray(r)?r:[r]).forEach(function(e){e.qError&&console.error("There is an issue with your dimension. Please fix this in order to receive the correct data. ",e.qError)})},i=function(){n.forEach(function(e){isNaN(e.qMax)&&isNaN(e.qMin)&&console.error("There is an issue with your measure. It is not returning any data.")})};r&&n?(o(),i()):r&&!n?o():!r&&n&&i()};function B(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var A={qData:null,qRData:null,qLayout:null,selections:null};function H(e,t,r){if(!e.s){if(r instanceof M){if(!r.s)return void(r.o=H.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(H.bind(null,e,t),H.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var M=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{H(n,1,i(this.v))}catch(e){H(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?H(n,1,t?t(o):o):r?H(n,1,r(o)):H(n,2,o)}catch(e){H(n,2,e)}},n},e}();function W(e){return e instanceof M&&1&e.s}function z(e,t){var r=t.payload,n=r.title,o=r.subTitle,i=r.metrics,u=r.qData,s=r.mData,a=r.nameKey,c=r.valueKey,l=r.qListData,q=r.dataList,f=r.dataKeys,p=r.qRData,h=r.qLayout,m=r.selections;switch(t.type){case"update":return d({},e,{title:n,subTitle:o,metrics:i,qData:u,mData:s,nameKey:a,valueKey:c,qListData:l,dataList:q,dataKeys:f,qLayout:h,selections:m});case"updateReducedData":return d({},e,{qRData:p});default:throw new Error}}var V={cols:[],qLists:null,qHyperCubeDef:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:1e3},qSortByAscii:1,qSortByLoadOrder:1,qInterColumnSortOrder:[],qSuppressZero:!1,qSortByExpression:0,qSuppressMissing:!0,qExpression:null,getQRData:!1,qSortByNumeric:-1,qColumnOrder:[],qCalcCondition:void 0,qTitle:null,qSubTitle:null,qMetrics:null,qOtherTotalSpec:""};function _(e,t,r,n,o,i,u,s,a,c,l,q,f,d,p){var h={qInfo:{qType:"visualization"}};if(r){var m=r;return e&&e[1]&&(m.qMeasures[0].qDef={qDef:e[1]}),e&&e[0]&&(m.qDimensions[0].qDef.qFieldDefs=[e[0]]),h.qInfo.qType="HyperCube",h.qHyperCubeDef=m,h}var y=i||[],b=!!i,v=0,C=e.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=");return r&&!b&&(y[t]=v,v+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:n,qSortByLoadOrder:o}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qGrouping:e.qGrouping||"N",qFieldDefs:Array.isArray(e.qField)?[].concat(e.qField):[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:o,qSortByAscii:n}]},qOtherTotalSpec:p,qOtherLabel:void 0!==d?d.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),g=e.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=");return r&&!b&&(y[t]=v,v+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:s,qSortByExpression:a,qExpression:l,qSuppressMissing:c},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return h.qHyperCubeDef={qDimensions:C,qMeasures:g,qInterColumnSortOrder:i,qSuppressZero:u,qSuppressMissing:c,qColumnOrder:q,qCalcCondition:f,qTitle:t},h}var K={qData:null,qRData:null,qLayout:null,headerGroup:null,selections:null};function U(e,t){var r=t.payload,n=r.title,o=r.qData,i=r.dataSet,u=r.qRData,s=r.headerGroup,a=r.qLayout,c=r.selections;switch(t.type){case"update":return d({},e,{title:n,qData:o,dataSet:i,headerGroup:s,qLayout:a,selections:c});case"updateReducedData":return d({},e,{qRData:u});default:throw new Error}}var G,J,Z={cols:null,qHyperCubeDef:null,qTitle:null,qPage:{qTop:0,qLeft:0,qWidth:10,qHeight:300},sortCriteria:{qInterColumnSortOrder:[],qSortByAscii:1,qSortByLoadOrder:1,qExpression:null,qSortByNumeric:-1,qSortByExpression:0},qSuppressZero:!1,qSuppressMissing:!0,getQRData:!1,qColumnOrder:[],qCalcCondition:void 0,qOtherTotalSpec:""},Q=require("enigma.js"),X=require("enigma.js/schemas/12.170.2.json"),$=require("enigma.js/sense-utilities"),Y={qPage:{qTop:0,qLeft:0,qWidth:1,qHeight:1e3},cols:null,qHyperCubeDef:null,config:null},ee=null,te=null,re={Uid:function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=e||8,n="",o=0;o<r;o+=1)n+=t.charAt(Math.floor(Math.random()*t.length));return n},globals:{qlik:null,resize:null}};function ne(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function oe(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var ie={id:null,comment:void 0,numberPresentation:void 0,includeInBookmark:!1,definition:null};exports.EngineContext=f,exports.Login=b,exports.Motor=function(t){var r=t.engine,o=t.children,i=t.licenseKey,u=t.logo,s=t.logoWidth,c=t.logoHeight,d=t.header,p=t.body,h=t.bodySub,m=t.size,y=t.buttonText,v=t.buttonFontColor,C=t.buttonColor,g=t.backgroundColor,S=t.loginfontFamily,D=t.NotConnectedheader,k=t.NotConnectedBody,L=t.NotConnectedButtonText,j=e.useState(t.config)[0],I=e.useState(!0),T=I[0],O=I[1],E=r?{engine:r,engineError:null,errorCode:null}:P(j),F=i?function(e){var t,r=[];for(t=1;t<101;t++)r.push("MotorLicense-"+t);var n=l.default.decrypt(e,"S@few/M0t0r").toString(q.default);return r.filter(function(e){return e==n})}(i):[];return e.useEffect(function(){O(F.length>0)},[i]),n.jsxs(f.Provider,{value:E,children:[n.jsx(b,{config:j,logo:u,logoHeight:c,logoWidth:s,header:d,body:p,bodySub:h,size:m,backgroundColor:g,buttonText:y,buttonFontColor:v,buttonColor:C,loginfontFamily:S}),n.jsx(x,{config:j,header:D,body:k,size:m,buttonText:L,backgroundColor:g,buttonFontColor:v,buttonColor:C,loginfontFamily:S}),T?n.jsx("div",{children:o}):n.jsx(a.default,{waterMarkText:"Powered by Motor",openSecurityDefense:!0,securityAlarm:function(){console.error("start alarm!")},options:{chunkWidth:200,chunkHeight:90,textAlign:"left",textBaseline:"bottom",globalAlpha:.27,font:"16px Roboto sans-serif",rotateAngle:-.19,fillStyle:"#666"},children:o})]})},exports.NotConnected=x,exports.useApp=function(){var t=(e.useContext(f)||{}).engine,r=e.useState(),n=r[0],o=r[1],i=function(e,r){try{return Promise.resolve(t).then(function(t){t.doReload(e,r,!1)})}catch(e){return Promise.reject(e)}};return e.useEffect(function(){return function(){try{var e=function(){if(void 0!==t)return Promise.resolve(t).then(function(e){return Promise.resolve(e.getAppProperties()).then(function(t){o(d({app:e,appProperties:t},t,{doReload:i}))})})}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[t]),d({},n)},exports.useBookmark=function(t){var r=(e.useContext(f)||{}).engine,n=e.useState(null),o=n[0],i=n[1],u=e.useState(null),s=u[0],a=u[1],c=e.useRef(null),l=e.useCallback(function(e){return c.current.getBookmark({qId:e})},[]),q=function(){try{return Promise.resolve(p()).then(function(e){var t=e.map(function(e,t){return{id:e.qInfo.qId,title:e.qMeta.title,description:e.qMeta.description,modifiedDate:e.qData.qBookmark.qUtcModifyTime}});i({bookmarks:e,bookmarkList:t})})}catch(e){return Promise.reject(e)}},p=e.useCallback(function(){return c.current.getBookmarks({qOptions:{qTypes:["bookmark"],qData:{}}})}),h=e.useCallback(function(){return q(),Promise.resolve()},[]);return e.useEffect(function(){if(r&&!c.current)try{return Promise.resolve(r).then(function(e){try{c.current=e,c.current.on("changed",function(){h()}),h()}catch(e){a(-2===e.code?"Bookmark Not Found":e)}})}catch(e){Promise.reject(e)}},[r]),d({},o,{applyBookmark:function(e){try{var t=c.current&&c.current.applyBookmark({qId:e}),r=function(){if(t)return Promise.resolve(l(e)).then(function(e){return Promise.resolve(e.getLayout()).then(function(t){i(d({},o,{appliedBookmark:e,bookmarkInfo:t}))})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},createBookmark:function(e,t,r){void 0===r&&(r=null);try{return Promise.resolve(c.current.createBookmark({qProp:{qInfo:{qId:r,qType:"bookmark"},qMetaDef:{title:e||"Unnamed bookmark",description:t}}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){return q(),e})})}catch(e){return Promise.reject(e)}},destroyBookmark:function(e){try{return Promise.resolve(c.current.destroyBookmark({qId:e})).then(function(e){return q(),e})}catch(e){return Promise.reject(e)}},getBookmark:l,getBookmarkLayout:function(e){try{return Promise.resolve(c.current.getBookmark({qId:e})).then(function(e){return Promise.resolve(e.getLayout())})}catch(e){return Promise.reject(e)}},updateBookmark:function(e,t,r){try{return Promise.resolve(l(e)).then(function(n){return Promise.resolve(n.setProperties({qProp:{qInfo:{qId:e,qType:"bookmark"},qMetaDef:{title:t,description:r}}})).then(function(){q()})})}catch(e){return Promise.reject(e)}},error:s})},exports.useButton=function(t){var r=L(Y,t),n=r.cols,o=r.qHyperCubeDef,i=(e.useContext(f)||{}).engine,u=e.useState(null),s=u[0],a=u[1],c=e.useRef(!0),l=e.useRef(null),q=e.useCallback(function(){return _(n,o)},[n,o]);return e.useEffect(function(){if(i&&n&&!l.current)try{var e=q();return Promise.resolve(i).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(e){return l.current=e,Promise.resolve(l.current.getLayout()).then(function(e){a(e)})})})}catch(e){Promise.reject(e)}},[q,i]),e.useEffect(function(){return function(){return c.current=!1}},[]),{clearSelections:function(){i&&i.clearAll()},previousSelection:function(){i&&i.back()},nextSelection:function(){i&&i.forward()},qLayout:s,exportData:function(e){i.getObject(s.qInfo.qId).then(function(e){e.exportData("CSV_C","/qHyperCubeDef","Test","P").then(function(e){console.log(e.qUrl,e.qWarnings)})})},select:function(e,t){try{return Promise.resolve(i).then(function(r){return Promise.resolve(r.getField(t)).then(function(t){t.select(e)})})}catch(e){return Promise.reject(e)}},selectValues:function(e,t,r){void 0===r&&(r=!1);try{return Promise.resolve(e.map(function(e){return{qText:e}})).then(function(e){return Promise.resolve(i).then(function(n){return Promise.resolve(n.getField(t)).then(function(t){t.selectValues(e,r)})})})}catch(e){return Promise.reject(e)}},doReload:function(e,t){try{return Promise.resolve(i).then(function(r){r.doReload(e,t,!1)})}catch(e){return Promise.reject(e)}}}},exports.useCapability=function(t){var r=e.useState(function(){!function(){try{!function(){if(t&&t.qcs){var e={host:t.host,isSecure:t.secure,port:t.port||443,prefix:""!==t.prefix?"/"+t.prefix+"/":"/",appId:t.appId,webIntegrationId:t.webIntId};return ne(function(){return Promise.resolve(function(e){try{var t;return Promise.resolve(ne(function(){function r(r){if(t)return r;var n=e.host,o=e.webIntId,i=document.createElement("link");i.rel="stylesheet",i.href="https://"+n+"/resources/autogenerated/qlik-styles.css",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}});var u=document.createElement("script");return u.src="https://"+n+"/resources/assets/external/requirejs/require.js",u.onload=function(){try{return window.require.config({baseUrl:"https://"+n+"/resources",webIntegrationId:o}),Promise.resolve()}catch(e){return Promise.reject(e)}},document.body.appendChild(u),u.loaded=new Promise(function(e){u.onload=function(){e()}}),J=Promise.all([i.loaded,u.loaded]),Promise.resolve(J).then(function(){})}var n=function(){if(J)return Promise.resolve(J).then(function(){t=1})}();return n&&n.then?n.then(r):r(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(e)).then(function(){window.require.config({baseUrl:"https://"+e.host+"/resources",webIntegrationId:t.webIntId}),window.require(["js/qlik"],function(t){try{var r=t.openApp(e.appId,e);return r.theme.get().then(function(e){e.apply()}),n(r),Promise.resolve(1)}catch(e){return Promise.reject(e)}})})},function(e){throw new Error(e)})}ne(function(){return Promise.resolve(function(e){try{var t;return Promise.resolve(ne(function(){function r(r){if(t)return r;var n=document.createElement("script"),o=""!==e.prefix?"/"+e.prefix:"";n.src=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/assets/external/requirejs/require.js",document.head.appendChild(n),n.loaded=new Promise(function(e){n.onload=function(){e()}});var i=document.createElement("link");return i.href=(e.secure?"https://":"http://")+e.host+(e.port?":"+e.port:"")+o+"/resources/autogenerated/qlik-styles.css",i.type="text/css",i.rel="stylesheet",document.head.appendChild(i),i.loaded=new Promise(function(e){i.onload=function(){e()}}),G=Promise.all([n.loaded,i.loaded]),Promise.resolve(G).then(function(){})}var n=function(){if(G)return Promise.resolve(G).then(function(){t=1})}();return n&&n.then?n.then(r):r(n)},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(){var e=""!==t.prefix?"/"+t.prefix+"/":"/";return window.require.config({baseUrl:(t.secure?"https://":"http://")+t.host+(t.port?":"+t.port:"")+e+"resources",paths:{qlik:(t.secure?"https://":"http://")+t.host+(t.port?":"+t.port:"")+e+"resources/js/qlik"},config:{text:{useXhr:function(){return!0}}}}),new Promise(function(r){if(re.globals.qlik){var o=re.globals.qlik.openApp(t.appId,d({},t,{isSecure:t.secure,prefix:e}));o.theme.get().then(function(e){e.apply()}),n(o)}else window.require(["js/qlik"],function(r){re.globals.qlik=r,re.globals.resize=function(){r.resize()};var o=r.openApp(t.appId,d({},t,{isSecure:t.secure,prefix:e}));return n(o),1})})})},function(e){throw new Error(e)})}()}catch(e){Promise.reject(e)}}()},[]),n=r[1];return{app:r[0]}},exports.useData=function(t){var r,n=L(V,t),o=n.cols,i=n.qLists,u=n.qTitle,s=n.qSubTitle,a=n.qMetrics,c=n.qHyperCubeDef,l=n.qPage,q=n.qSortByAscii,p=n.qSortByLoadOrder,h=n.qInterColumnSortOrder,m=n.qSuppressZero,y=n.qSortByNumeric,b=n.qSortByExpression,v=n.qSuppressMissing,C=n.qExpression,g=n.qColumnOrder,S=n.qCalcCondition,P=n.getQRData,D=n.qOtherTotalSpec,x=e.useRef(!0),k=e.useReducer(z,A),j=k[0],I=k[1],T=j.title,O=j.subTitle,E=j.metrics,F=j.qData,_=j.mData,K=j.nameKey,U=j.valueKey,G=j.qListData,J=j.dataList,Z=j.dataKeys,Q=j.qRData,X=j.qLayout,$=j.selections,Y=(e.useContext(f)||{}).engine,ee=e.useRef(null),te=e.useRef(l),re=e.useState()[1],ne=e.useState(te.current.qHeight)[0];"object"==typeof D?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:D.qOtherCount}:D?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:D||(r={qOtherMode:"OTHER_OFF",qOtherCounted:""});var oe=e.useCallback(function(){var e={qInfo:{qType:"visualization"}};if(a&&a.map(function(t){var r;e[t.qName]=((r={})[t.qType?t.qType:"qValueExpression"]={qExpr:t.qExpr},r)}),i&&(e.qListObjects=[],i.map(function(t){var r={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:[Object.values(t)[0]],qFieldLabels:[Object.keys(t)[0]],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};e.qListObjects.push(r)})),c){var t=c;return o&&o[1]&&(t.qMeasures[0].qDef={qDef:o[1]}),o&&o[0]&&(t.qDimensions[0].qDef.qFieldDefs=[o[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=t,e}var n=h||[],s=!!h,l=0,f=o&&o.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return r&&!s&&(n[t]=l,l+=1),r}).map(function(e){if("string"==typeof e)return{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:q,qSortByLoadOrder:p}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0};if("object"==typeof e&&!e.qLibraryId){var t=[];if(e.qAttributeExpressions)for(var n=0,o=Object.entries(e.qAttributeExpressions);n<o.length;n++){var i=o[n];t.push({id:i[0],qExpression:i[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:p,qSortByAscii:q}]},qOtherTotalSpec:r,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:t,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}if("object"==typeof e&&e.qLibraryId){var u=[];if(e.qAttributeExpressions)for(var s=0,a=Object.entries(e.qAttributeExpressions);s<a.length;s++){var c=a[s];u.push({id:c[0],qExpression:c[1],qLibraryId:"",qAttribute:!1})}return{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:r,qOtherLabel:void 0!==D?D.qOtherLabel:"Others",qAttributeExpressions:u,qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}return e});if(f&&f.length>1){var d={qListObjectDef:{qStateName:"$",qLibraryId:"",qDef:{qFieldDefs:f[1].qDef.qFieldDefs,qFieldLabels:["multiDimDataKeys"],qSortCriterias:[{qSortByLoadOrder:1}]},qInitialDataFetch:[{qTop:0,qHeight:1,qLeft:0,qWidth:1}]}};void 0===e.qListObjects&&(e.qListObjects=[]),e.qListObjects.push(d)}var P=o&&o.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return r&&!s&&(n[t]=l,l+=1),r}).map(function(e){if("string"==typeof e)return{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:C,qSuppressMissing:v}};if("object"==typeof e){var t=[];if(e.qAttributeExpressions)for(var r=0,n=Object.entries(e.qAttributeExpressions);r<n.length;r++){var o=n[r];t.push({id:o[0],qExpression:o[1],qLibraryId:"",qAttribute:!1})}return{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:y,qSortByExpression:b,qExpression:C,qSuppressMissing:v},qAttributeExpressions:t}}return e});return e.qHyperCubeDef={qDimensions:f,qMeasures:P,qInterColumnSortOrder:h,qSuppressZero:m,qSuppressMissing:v,qColumnOrder:g,qCalcCondition:S,qTitle:u},e},[o,u,C,c,h,q,b,p,v,m]),ie=e.useCallback(function(){return ee.current.getLayout()},[]),ue=e.useCallback(function(){try{return Promise.resolve(B(function(){return Promise.resolve(ee.current.getHyperCubeData("/qHyperCubeDef",[te.current])).then(function(e){return e[0]})},function(e){re(e)}))}catch(e){return Promise.reject(e)}},[]),se=e.useCallback(function(e){try{var t=ee.current,r=te.current,n=null,o=[];return Promise.resolve(B(function(){function i(){return{qTails:n[0].qTails,qMatrix:o,qArea:n[0].qArea}}var u=0,s=function(e,t,r){for(var n;;){var o=e();if(W(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!W(i)){n=1;break}i=i.s}if(t){var u=t();if(u&&u.then&&!W(u)){n=2;break}}}var s=new M,a=H.bind(null,s,2);return(0===n?o.then(l):1===n?i.then(c):u.then(q)).then(void 0,a),s;function c(n){i=n;do{if(t&&(u=t())&&u.then&&!W(u))return void u.then(q).then(void 0,a);if(!(o=e())||W(o)&&!o.v)return void H(s,1,i);if(o.then)return void o.then(l).then(void 0,a);W(i=r())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,a)}function l(e){e?(i=r())&&i.then?i.then(c).then(void 0,a):c(i):H(s,1,i)}function q(){(o=e())?o.then?o.then(l).then(void 0,a):l(o):H(s,1,i)}}(function(){return u<e},function(){return u++},function(){return r=d({},r,{qTop:1e3*u}),Promise.resolve(t.getHyperCubeData("/qHyperCubeDef",[r])).then(function(e){o.push.apply(o,(n=e)[0].qMatrix)})});return s&&s.then?s.then(i):i()},function(e){re(e)}))}catch(e){return Promise.reject(e)}},[]),ae=e.useCallback(function(e){try{return Promise.resolve(ee.current.getListObjectData("/qListObjects/"+e+"/qListObjectDef",[te.current]))}catch(e){return Promise.reject(e)}}),ce=e.useCallback(function(e){try{return e.qListObjects?Promise.resolve(Promise.all(e.qListObjects.map(function(e,t){try{return Promise.resolve(ae(t))}catch(e){return Promise.reject(e)}}))):Promise.resolve()}catch(e){return Promise.reject(e)}},[]),le=e.useCallback(function(e){try{return Promise.resolve(0===e.qHyperCube.qDimensionInfo.length?null:e.qHyperCube.qDimensionInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),qe=e.useCallback(function(e){try{return Promise.resolve(0===e.qHyperCube.qMeasureInfo.length?null:e.qHyperCube.qMeasureInfo[0].qFallbackTitle)}catch(e){return Promise.reject(e)}},[]),fe=e.useCallback(function(){return function(){try{var e=te.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(ee.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),de=e.useCallback(function(e,t){try{if(0===e.qHyperCube.qDimensionInfo.length&&0===e.qHyperCube.qMeasureInfo.length||!t)return Promise.resolve();var r=1===e.qHyperCube.qDimensionInfo.length?function(e,t,r){var n=void 0!==t?t.qDimensionInfo.length:1,o=w(t),i=N(t);return e.qMatrix.map(function(e,u){var s={},a={};return e.forEach(function(c,l){var q,f;if(l<n){var p=e[l].qAttrExps;void 0!==p&&p.qValues.forEach(function(e,r){void 0!==e.qText&&(a[t.qDimensionInfo[l].qAttrExprInfo[r].id]="NaN"!==e.qNum?e.qNum:e.qText)})}else{var h=e[l].qAttrExps;void 0!==h&&h.qValues.forEach(function(e,r){void 0!==e.qText&&(a[t.qMeasureInfo[l- -n].qAttrExprInfo[r].id]="NaN"!==e.qNum?e.qNum:e.qText)})}var m=l<n?((q={})[i[l]]=e[l].qText,q["elemNumber"+(0!==l?l:"")]=e[l].qElemNumber,q.key=u,q.label=e[l].qText,q):((f={})[o[l-n]]=r[l].qNumFormat||r[l].qNumType||r[l].qNumFmt?e[l].qText:"NaN"!==e[l].qNum?e[l].qNum:0,f.key=u,f);s=d({},s,m,a)}),s})}(t,e.qHyperCube,o):function(e,t){var r=void 0!==t?t.qDimensionInfo.length:1;w(t);var n=N(t),o=e.qMatrix[0][0].qText,i=[],u={};return e.qMatrix.map(function(e,t){var s=null,a=null,c=null;e.forEach(function(t,n){n<r&&0!==n?(s=e[n].qText,c=e[n].qElemNumber):0!==n&&(a=e[n].qNum)}),o!==e[0].qText?(0===Object.keys(u).length&&(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c),i.push(u),u={}):(u[n[0]]=e[0].qText,u.qElemNumber=e[0].qElemNumber,u[s]=a,u[s+"-qElemNumber"]=c,u.label=e[0].qText),o=e[0].qText}),i.push(u),i}(t,e.qHyperCube);return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[]),pe=e.useCallback(function(e,t){try{if(!e)return Promise.resolve(t.map(function(e){return e.qFallbackTitle}));var r=e.filter(function(e){return"multiDimDataKeys"===Object.keys(e)[0]});return Promise.resolve(r[0].multiDimDataKeys)}catch(e){return Promise.reject(e)}},[]),he=e.useCallback(function(e,t){try{var r=[];return t.qListObjects?(t.qListObjects.map(function(t,n){var o={},i=t.qListObject.qDimensionInfo.qFallbackTitle,u=e[n][0]?e[n][0].qMatrix.map(function(e){return e[0].qText}):null;o[i]=u,r.push(o)}),Promise.resolve(r)):Promise.resolve(null)}catch(e){return Promise.reject(e)}},[]),me=e.useCallback(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),ye=e.useCallback(function(e,t){try{if(!t)return Promise.resolve();var r={};return t.map(function(t){r[t.qName]=e[t.qName]}),Promise.resolve(r)}catch(e){return Promise.reject(e)}},[]),be=e.useCallback(function(){try{return Promise.resolve(ie()).then(function(e){return Promise.resolve(R(e)).then(function(t){return Promise.resolve(Math.ceil(e.qHyperCube.qSize.qcy/ne)<=1?ue():se(Math.ceil(e.qHyperCube.qSize.qcy/ne))).then(function(t){return Promise.resolve(ce(e)).then(function(r){return Promise.resolve(de(e,t)).then(function(n){return Promise.resolve(le(e)).then(function(o){return Promise.resolve(qe(e)).then(function(i){return Promise.resolve(he(r,e)).then(function(u){return Promise.resolve(pe(u,e.qHyperCube.qMeasureInfo)).then(function(c){return Promise.resolve(me(e)).then(function(l){var q=s;return Promise.resolve(ye(e,a)).then(function(s){if(t&&x.current){var a=t.qMatrix.filter(function(e){return"S"===e[0].qState});I({type:"update",payload:{title:l,subTitle:q,qData:t,mData:n,nameKey:o,valueKey:i,qListData:r,dataList:u,dataKeys:c,metrics:s,qLayout:e,selections:a}})}else x.current&&I({type:"update",payload:{title:l,subTitle:q,metrics:s,qData:t,mData:n,nameKey:o,valueKey:i,qListData:r,dataList:u,dataKeys:c,qLayout:e}});var f=function(){if(P)return Promise.resolve(fe()).then(function(e){x.current&&I({type:"updateReducedData",payload:{qRData:e}})})}();if(f&&f.then)return f.then(function(){})})})})})})})})})})})})}catch(e){return Promise.reject(e)}},[ue,ie,P,fe]),ve=e.useCallback(function(e){te.current=d({},te.current,e),be()},[be]),Ce=e.useCallback(function(){return ee.current.beginSelections(["/qHyperCubeDef"])},[!0]),ge=e.useCallback(function(e){return ee.current.endSelections(e)},[]),Se=e.useCallback(function(e,t,r){return void 0===r&&(r=!1),ee.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),Pe=e.useCallback(function(e){return ee.current.applyPatches(e)},[]),De=e.useCallback(function(e,t){try{return Promise.resolve(Pe([{qOp:"replace",qPath:"/qHyperCubeDef/"+(e?"qMeasures":"qDimensions")+"/0/qDef/"+(e?"qDef":"qFieldDefs"),qValue:JSON.stringify(e?t:[t])}])).then(function(){})}catch(e){return Promise.reject(e)}},[Pe,X]);e.useEffect(function(){if(Y&&!ee.current)try{var e=oe();return Promise.resolve(Y).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){ee.current=t,ee.current.on("changed",function(){be(e.qHyperCubeDef.qMeasures)}),be(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[oe,Y,be]),e.useEffect(function(){return function(){return x.current=!1}},[]);var xe={};return _&&(xe.data=_),_&&(xe.select=Se),Z&&0!==Z.length&&(xe.dataKeys=Z),J&&(xe.dataList=J),K&&(xe.nameKey=K),U&&(xe.valueKey=U),{beginSelections:Ce,endSelections:ge,qLayout:X,qData:F,mData:_,qListData:G,dataList:J,handlerChange:De,dataKeys:Z,nameKey:K,dataSet:xe,title:T,subTitle:O,metrics:E,qRData:Q,changePage:ve,selections:$,select:Se,applyPatches:Pe}},exports.useEngine=P,exports.useGlobal=function(t){var r=[{onRejected:function(e,t,r){return console.warn("Captured Request: Rejected","Error Code: "+r.code+" : "+r),r.code===X.enums.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(t.tries=(t.tries||0)+1,console.warn("Captured Request: Retry #"+t.tries),t.tries<=3)?t.retry():r.code===X.enums.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS||r.code===X.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?r.code:(console.warn(r),this.Promise.reject(r))}}],n=e.useState(!1),o=n[0],i=n[1],u=e.useState(null),s=u[0],a=u[1],c=e.useState(function(){!function(){try{var e,n=function(n){return e?n:function(){if(t){var e=$.buildUrl(t);return function(t,n){try{var o=((i=Q.create({schema:X,url:e,responseInterceptors:r})).on("suspended",function(){console.warn("Captured session suspended")}),i.on("error",function(){console.warn("Captured session error")}),i.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(i.open()).then(function(e){return Promise.resolve(e.engineVersion()).then(function(t){return Promise.resolve(e.getDocList({})).then(function(r){return Promise.resolve(e.oSName()).then(function(n){return Promise.resolve(e.oSVersion()).then(function(o){return l({global:e,docList:r,engineVersion:t,oSName:n,oSVersion:o}),a(1),1})})})})}))}catch(e){return n(e)}var i;return o&&o.then?o.then(void 0,n):o}(0,function(e){return console.warn("Captured Error",e),1003===e.code&&i("No engine. App Not found."),a(-2),-2})}}()},o=function(){if(t&&t.qcs){var n=t.host,o=t.webIntId;return Promise.resolve(fetch("https://"+n+"/api/v1/csrf-token",{mode:"cors",credentials:"include",headers:{"qlik-web-integration-id":o,"content-type":"application/json"}}).catch(function(e){console.log("caught failed fetch",e)})).then(function(i){var u=i.headers.get("qlik-csrf-token");if(null==u)return console.log("Not logged in"),a(-1),e=1,-1;var s=Q.create({schema:X,url:"wss://"+n+"/app/"+t.appId+"?qlik-web-integration-id="+o+"&qlik-csrf-token="+u,createSocket:function(e){return new WebSocket(e)},responseInterceptors:r});return s.on("suspended",function(){console.warn("Captured session suspended")}),s.on("error",function(){console.warn("Captured session error")}),s.on("closed",function(){return console.warn("Session was closed"),a(-3),-3}),Promise.resolve(s.open()).then(function(t){return Promise.resolve(t.engineVersion()).then(function(r){return Promise.resolve(t.getDocList({})).then(function(n){return Promise.resolve(t.oSName()).then(function(o){return Promise.resolve(t.oSVersion()).then(function(i){return l({global:t,docList:n,engineVersion:r,oSName:o,oSVersion:i}),a(1),e=1})})})})})})}}();o&&o.then?o.then(n):n(o)}catch(e){Promise.reject(e)}}()},[]),l=c[1];return d({},c[0],{globalError:o,errorCode:s})},exports.useHyperCube=function(t){var r,n=L(T,t),o=n.cols,i=n.qHyperCubeDef,u=n.qPage,s=n.qSortByAscii,a=n.qSortByLoadOrder,c=n.qInterColumnSortOrder,l=n.qSuppressZero,q=n.qSortByNumeric,p=n.qSortByExpression,h=n.qSuppressMissing,m=n.qExpression,y=n.qColumnOrder,b=n.qCalcCondition,v=n.getQRData,C=n.qOtherTotalSpec,g=e.useRef(!0),S=e.useReducer(I,j),P=S[0],D=S[1],x=P.qData,k=P.qRData,O=P.qLayout,E=P.selections,F=(e.useContext(f)||{}).engine,w=e.useRef(null),N=e.useRef(u);"object"==typeof C?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:C.qOtherCount}:C?r={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:C||(r={qOtherMode:"OTHER_OFF",qOtherCounted:""});var R=e.useCallback(function(){var e={qInfo:{qType:"visualization"}};if(i){var t=i;return o&&o[1]&&(t.qMeasures[0].qDef={qDef:o[1]}),o&&o[0]&&(t.qDimensions[0].qDef.qFieldDefs=[o[0]]),e.qInfo.qType="HyperCube",e.qHyperCubeDef=t,e}var n=c||[],u=!!c,f=0,d=o.filter(function(e,t){var r="string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||"object"==typeof e&&!e.qField.startsWith("=");return r&&!u&&(n[t]=f,f+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByAscii:s,qSortByLoadOrder:a}]},qNullSuppression:!0,qSuppressMissing:!0,qShowTotalsAbove:!0}:"object"!=typeof e||e.qLibraryId?"object"==typeof e&&e.qLibraryId?{qLibraryId:e.qLibraryId,qType:e.qType,qOtherTotalSpec:r,qOtherLabel:void 0!==C?C.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}:e:{qDef:{qFieldDefs:[e.qField],qFieldLabels:[e.qLabel],qSortCriterias:e.qSortCriterias?[e.qSortCriterias]:[{qSortByLoadOrder:a,qSortByAscii:s}]},qOtherTotalSpec:r,qOtherLabel:void 0!==C?C.qOtherLabel:"Others",qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qNullSuppression:!e.qNullSuppression||e.qNullSuppression,qSuppressMissing:!0,qShowTotalsAbove:!0}}),v=o.filter(function(e,t){var r="string"==typeof e&&e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qDef||"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&e.qField.startsWith("=");return r&&!u&&(n[t]=f,f+=1),r}).map(function(e){return"string"==typeof e?{qDef:{qDef:e,qNumFormat:e.qNumFormat},qSortBy:{qSortByNumeric:q,qSortByExpression:p,qExpression:m,qSuppressMissing:h}}:"object"==typeof e?{qDef:{qDef:e.qField,qLabel:e.qLabel,qNumFormat:{qType:e.qNumType||"U",qUseThou:1,qFmt:e.qNumFmt,qDec:".",qThou:","}},qSortBy:{qSortByNumeric:q,qSortByExpression:p,qExpression:m,qSuppressMissing:h},qAttributeExpressions:[{qExpression:e.qCondBackgroundFormat,qLibraryId:"",qAttribute:!1,id:"cellBackgroundColor"},{qExpression:e.qCondTextFormat,qLibraryId:"",qAttribute:!1,id:"cellForegroundColor"},{qExpression:e.qCondChartColor,qLibraryId:"",qAttribute:!1,id:"colorTheme"}],qChartType:e.qChartType,qShowPoints:e.qShowPoints,qCurve:e.qCurve,qFillStyle:e.qFillStyle,qLegendShape:e.qLegendShape}:e});return e.qHyperCubeDef={qDimensions:d,qMeasures:v,qInterColumnSortOrder:c,qSuppressZero:l,qSuppressMissing:h,qColumnOrder:y,qCalcCondition:b},e},[o,m,i,c,s,p,a,h,l]),B=e.useCallback(function(){return w.current.getLayout()},[]),A=e.useCallback(function(){try{return Promise.resolve(w.current.getHyperCubeData("/qHyperCubeDef",[N.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),H=e.useCallback(function(){return function(){try{var e=N.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(w.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),M=e.useCallback(function(e){try{return Promise.resolve(B()).then(function(t){return Promise.resolve(A()).then(function(r){if(r&&g.current){var n=r.qMatrix.filter(function(e){return"S"===e[0].qState});e&&e.map(function(e,r){t.qHyperCube.qMeasureInfo[r]&&(t.qHyperCube.qMeasureInfo[r].qChartType=e.qChartType,t.qHyperCube.qMeasureInfo[r].qShowPoints=e.qShowPoints,t.qHyperCube.qMeasureInfo[r].qCurve=e.qCurve,t.qHyperCube.qMeasureInfo[r].qFillStyle=e.qFillStyle,t.qHyperCube.qMeasureInfo[r].qLegendShape=e.qLegendShape)}),D({type:"update",payload:{qData:r,qLayout:t,selections:n}})}else g.current&&D({type:"update",payload:{qData:r,qLayout:t}});var o=function(){if(v)return Promise.resolve(H()).then(function(e){g.current&&D({type:"updateReducedData",payload:{qRData:e}})})}();if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},[A,B,v,H]),W=e.useCallback(function(e){N.current=d({},N.current,e),M()},[M]),z=e.useCallback(function(){return w.current.beginSelections(["/qHyperCubeDef"])},[!0]),V=e.useCallback(function(e){return w.current.endSelections(e)},[]),_=e.useCallback(function(e,t,r){return void 0===r&&(r=!1),w.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),K=e.useCallback(function(e){return w.current.applyPatches(e)},[]);return e.useEffect(function(){if(F&&!w.current)try{var e=R();return Promise.resolve(F).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){w.current=t,w.current.on("changed",function(){M(e.qHyperCubeDef.qMeasures)}),M(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[R,F,M]),e.useEffect(function(){return function(){return g.current=!1}},[]),{beginSelections:z,endSelections:V,qLayout:O,qData:x,qRData:k,changePage:W,selections:E,select:_,applyPatches:K}},exports.useLayout=function(){var t=(e.useContext(f)||{}).engine,r=e.useState(null),n=r[0],o=r[1],i=e.useState(null),u=i[0],s=i[1];return e.useEffect(function(){return function(){try{if(!t)return Promise.resolve();var e=function(e,r){try{var n=Promise.resolve(t).then(function(e){return Promise.resolve(e.getAppLayout()).then(function(e){o(d({appLayout:e},e))})})}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}(0,function(e){s(e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[t]),d({},n,{error:u})},exports.useList=function(t){var r=L(F,t),n=r.qPage,o=r.dimension,i=r.qListObjectDef,u=r.qSortByAscii,s=r.qSortByLoadOrder,a=r.autoSortByState,c=(e.useContext(f)||{}).engine,l=e.useRef(!0),q=e.useReducer(E,O),p=q[0],h=q[1],m=p.listData,y=p.selections,b=p.selectionsId,v=e.useRef(null),C=e.useRef(n),g=e.useCallback(function(e){void 0===e&&(e=0);var t={qInfo:{qType:"visualization"}};if(i)t.qListObjectDef=i;else{var r=o.filter(function(e){return"string"==typeof e&&!e.startsWith("=")||"object"==typeof e&&e.qDef&&e.qDef.qFieldDefs||"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType}).map(function(e){return"string"==typeof e?{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByLoadOrder:s,qSortByAscii:u}]}}:e});t.qListObjectDef=d({},{qLibraryId:"object"==typeof o[0]&&o[0].qLibraryId?o[0].qLibraryId:""},r[e],{qShowAlternatives:!0,qAutoSortByState:{qDisplayNumberOfRows:a}})}return t},[a,o,i,u,s]),S=e.useCallback(function(){try{return Promise.resolve(v.current.getListObjectData("/qListObjectDef",[C.current])).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},[]),P=e.useCallback(function(e){try{if(!m){if(!e)return Promise.resolve(null);var t=[];e.qMatrix.map(function(e,r){t.push({key:e[0].qElemNumber,text:void 0!==e[0].qText?e[0].qText:"undefined",number:e[0].qNumber,state:e[0].qState,value:void 0!==e[0].qText?e[0].qText:"undefined",label:void 0!==e[0].qText?e[0].qText:"undefined"})});var r=t&&t.filter(function(e){return"S"===e.state}),n=r&&r.map(function(e){return e.key});return Promise.resolve({_selId:n,_selections:r,_listData:t})}return Promise.resolve()}catch(e){return Promise.reject(e)}},[m]),D=e.useCallback(function(){try{return Promise.resolve(S()).then(function(e){return Promise.resolve(P(e)).then(function(t){var r=t._listData;e&&l.current?h({type:"update",payload:{listData:r,selections:t._selections,selectionsId:t._selId}}):l.current&&h({type:"update",payload:{listData:r}})})})}catch(e){return Promise.reject(e)}},[S,P]),x=e.useCallback(function(e){C.current=d({},C.current,e),D()},[D]),k=e.useCallback(function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=!1),v.current.selectListObjectValues("/qListObjectDef",e,t,r)},[]),j=e.useCallback(function(e){return v.current.searchListObjectFor("/qListObjectDef",e)},[]),I=e.useCallback(function(e){return void 0===e&&(e=!1),v.current.acceptListObjectSearch("/qListObjectDef",!0,e)},[]),T=e.useCallback(function(e){return v.current.applyPatches(e)},[]),w=e.useCallback(function(){return v.current.clearSelections("/qListObjectDef")},[]);return e.useEffect(function(){if(c&&!v.current)try{var e=g();return Promise.resolve(c).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(e){v.current=e,l.current&&h({type:"init",payload:{qDoc:t}}),v.current.on("changed",function(){D()}),D()})})}catch(e){Promise.reject(e)}},[g,c,D]),e.useEffect(function(){return function(){return l.current=!1}},[]),{listData:m,changePage:x,select:k,beginSelections:function(){try{return Promise.resolve(p.qDoc.abortModal(!0)).then(function(){return Promise.resolve(v.current.beginSelections(["/qListObjectDef"])).then(function(){})})}catch(e){return Promise.reject(e)}},endSelections:function(e){try{return Promise.resolve(v.current.endSelections(e)).then(function(){})}catch(e){return Promise.reject(e)}},searchListObjectFor:j,acceptListObjectSearch:I,applyPatches:T,selections:y,selectionsId:b,clearSelections:w,motorListProps:{clearSelections:w,selections:y,select:k}}},exports.useSearch=function(t){var r=t.searchValue,n=t.dimensions,o=t.qCount,i=t.qGroupItemCount,u=e.useState([]),s=u[0],a=u[1],c=e.useState([]),l=c[0],q=c[1],d=e.useRef(!0),p=(e.useContext(f)||{}).engine;e.useEffect(function(){void 0===p||function(){try{var e=function(e,t){try{var u=Promise.resolve(p).then(function(e){return Promise.resolve(e.searchResults({qSearchFields:n},[r],{qOffset:0,qCount:o,qGroupItemOptions:[{qGroupItemType:"FIELD",qOffset:0,qCount:i}]})).then(function(e){return Promise.resolve(e).then(function(e){return Promise.resolve(h(e)).then(function(e){return Promise.resolve(m(e)).then(function(t){a(e),q(t),d.current&&(a(e),q(t))})})})})})}catch(e){return t(e)}return u&&u.then?u.then(void 0,t):u}(0,function(e){console.warn(e)});e&&e.then&&e.then(function(){})}catch(e){Promise.reject(e)}}()},[p,r,o,i,n]),e.useEffect(function(){return function(){return d.current=!1}},[]);var h=function(e){var t=[],r={};return e.qSearchGroupArray.map(function(e){r.id=e.qId,r.dimension=e.qItems[0].qIdentifier,r.value=e.qItems[0].qItemMatches,t.push(r),r={}}),t},m=function(e){var t=[],r={};return e.map(function(e){e.value.map(function(n){r.dimension=e.dimension,r.value=n.qText,t.push(r),r={}})}),t},y=e.useCallback(function(e){return function(){try{return Promise.resolve(p).then(function(t){t.selectAssociations({qSearchFields:n,qContext:"CurrentSelections"},[r],e)})}catch(e){return Promise.reject(e)}}()});return{groupResults:s,flatResults:l,flatSelect:e.useCallback(function(e,t){return function(){try{return Promise.resolve(p).then(function(r){return Promise.resolve(r.getField(e)).then(function(e){e.select(t)})})}catch(e){return Promise.reject(e)}}()}),groupSelect:y}},exports.useSelections=function(){var t=(e.useContext(f)||{}).engine,r=e.useRef(!0),n=e.useState(null),o=n[0],i=n[1],u=e.useState(null),s=u[0],a=u[1],c=e.useCallback(function(){try{return Promise.resolve(te.getLayout()).then(function(e){return Promise.resolve(l(e)).then(function(t){r.current&&(i(e),a(t))})})}catch(e){return Promise.reject(e)}},[]),l=function(e){return e.qSelectionObject.qSelections};return e.useEffect(function(){if(void 0===t);else try{var e={qInfo:{qType:"SelectionObject"},qSelectionObjectDef:{}};return Promise.resolve(t).then(function(t){return ee=t,Promise.resolve(ee.createSessionObject(e)).then(function(e){(te=e).on("changed",function(){c()}),c()})})}catch(e){Promise.reject(e)}},[t,c]),e.useEffect(function(){return function(){return r.current=!1}},[]),{qLayout:o,selections:s,clearSelections:function(e,t){try{var r=function(){if(e)return Promise.resolve(ee.getField(e)).then(function(e){var r=t?Promise.resolve(e.toggleSelect(t)).then(function(){}):Promise.resolve(e.clear()).then(function(){});if(r&&r.then)return r.then(function(){})});ee.clearAll()}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}}},exports.useTable=function(t){var r=L(Z,t),n=r.cols,o=r.qTitle,i=r.qHyperCubeDef,u=r.qPage,s=r.sortCriteria,a=r.qSuppressZero,c=r.qSuppressMissing,l=r.qColumnOrder,q=r.qCalcCondition,p=r.getQRData,h=r.qOtherTotalSpec,m=e.useRef(!0),y=e.useReducer(U,K),b=y[0],v=y[1],C=s.qInterColumnSortOrder,g=s.qSortByAscii,S=s.qSortByLoadOrder,P=s.qExpression,D=s.qSortByNumeric,x=s.qSortByExpression,k=b.title,j=b.qData,I=b.dataSet,T=b.qRData,O=b.headerGroup,E=b.qLayout,F=b.selections,w=(e.useContext(f)||{}).engine,N=e.useRef(null),B=e.useRef(u),A=e.useState()[1],H=e.useState(B.current.qHeight)[0],M=e.useState(0),W=M[0],z=M[1],V=e.useCallback(function(e){z(e),se({qTop:e*H})},[se,H]);window.setPage=V;var G,J=e.useState(0),Q=J[0],X=J[1],$=e.useCallback(function(e){W>=e&&V(0),X(e)},[W,V]),Y=e.useCallback(function(e){V(e)},[V]);e.useEffect(function(){E&&j&&$(Math.ceil(E.qHyperCube.qSize.qcy/H))},[E,j,H,V,$]),"object"==typeof h?G={qOtherMode:"OTHER_COUNTED",qOtherCounted:h.qOtherCount}:h?G={qOtherMode:"OTHER_COUNTED",qOtherCounted:"8"}:h||(G={qOtherMode:"OTHER_OFF",qOtherCounted:""});var ee=e.useCallback(function(){return _(n,o,i,g,S,C,a,D,x,c,P,l,q,h,G)},[n,o,P,i,C,g,x,S,c,h,a]),te=e.useCallback(function(){return N.current.getLayout()},[]),re=e.useCallback(function(){try{return Promise.resolve(function(e,t){try{var r=Promise.resolve(N.current.getHyperCubeData("/qHyperCubeDef",[B.current])).then(function(e){return e[0]})}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(0,function(e){A(e)}))}catch(e){return Promise.reject(e)}},[]),ne=e.useCallback(function(e){try{return Promise.resolve(e.qHyperCube.qTitle)}catch(e){return Promise.reject(e)}},[]),oe=e.useCallback(function(){return function(){try{var e=B.current.qWidth,t={qTop:0,qLeft:0,qWidth:e,qHeight:Math.round(1e4/e)};return Promise.resolve(N.current.getHyperCubeReducedData("/qHyperCubeDef",[t],-1,"D1")).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}}},[]),ie=e.useCallback(function(e,t,r){try{var n=function(e,t,r){return e.qMatrix.map(function(e,t){var n={};return e.forEach(function(o,i){var u,s=((u={})[r[i].dataKey]={text:e[i].qText,number:e[i].qNum,elemNumber:e[i].qElemNumber,state:e[i].qState,attrExp:e[i].qAttrExps,columnId:i},u.key=t,u);n=d({},n,s)}),n})}(t,0,r);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},[]),ue=e.useCallback(function(){try{return Promise.resolve(te()).then(function(e){return Promise.resolve(ne(e)).then(function(t){return Promise.resolve(R(e)).then(function(r){return Promise.resolve(re()).then(function(r){return Promise.resolve(function(e){var t=[],r=[];return function(e){e.filter(function(e,t){return"object"==typeof e&&e.qLibraryId&&e.qType&&"dimension"===e.qType||Array.isArray(e.qField)||"object"==typeof e&&!e.qField.startsWith("=")}).map(function(e){return t.push(e),e})}(e),function(e){e.filter(function(e,t){return"object"==typeof e&&e.qLibraryId&&e.qType&&"measure"===e.qType||"object"==typeof e&&!Array.isArray(e.qField)&&e.qField.startsWith("=")}).map(function(e){return r.push(e),e})}(e),t.concat(r)}(n)).then(function(n){function o(o){function i(n){if(r&&m.current){var i=r.qMatrix.filter(function(e){return"S"===e[0].qState});v({type:"update",payload:{title:t,qData:r,dataSet:o,headerGroup:n,qLayout:e,selections:i}})}else m.current&&v({type:"update",payload:{title:t,qData:r,dataSet:o,headerGroup:n,qLayout:e}});var u=function(){if(p)return Promise.resolve(oe()).then(function(e){m.current&&v({type:"updateReducedData",payload:{qRData:e}})})}();if(u&&u.then)return u.then(function(){})}return r?Promise.resolve(function(e,t,r){return e?[].concat(e.qHyperCube.qDimensionInfo.map(function(e,r){return{title:e.qFallbackTitle,dataIndex:t[r].dataKey,dataKey:t[r].dataKey,render:t[r].render,defaultSortDesc:"D"===e.qSortIndicator,qInterColumnIndex:r,qPath:"/qHyperCubeDef/qDimensions/"+r,qSortIndicator:e.qSortIndicator,qReverseSort:e.qReverseSort,qGrandTotals:{qText:null,qNum:null},qColumnType:"dim"}}),e.qHyperCube.qMeasureInfo.map(function(r,n){return{title:r.qFallbackTitle,dataIndex:t[e.qHyperCube.qDimensionInfo.length+n].dataKey,dataKey:t[e.qHyperCube.qDimensionInfo.length+n].dataKey,render:t[e.qHyperCube.qDimensionInfo.length+n].render,defaultSortDesc:"D"===r.qSortIndicator,qInterColumnIndex:n+e.qHyperCube.qDimensionInfo.length,qPath:"/qHyperCubeDef/qMeasures/"+n,qSortIndicator:r.qSortIndicator,qReverseSort:r.qReverseSort,qGrandTotals:e.qHyperCube.qGrandTotalRow[n],qColumnType:"meas"}})):[]}(e,n)).then(i):i(r)}return r?Promise.resolve(ie(e,r,n)).then(o):o(r)})})})})})}catch(e){return Promise.reject(e)}},[re,te,p,oe]),se=e.useCallback(function(e){B.current=d({},B.current,e),ue()},[ue]),ae=e.useCallback(function(){return N.current.beginSelections(["/qHyperCubeDef"])},[!0]),ce=e.useCallback(function(e){return N.current.endSelections(e)},[]),le=e.useCallback(function(e,t,r){return void 0===r&&(r=!1),N.current.selectHyperCubeValues("/qHyperCubeDef",e,t,r)},[]),qe=e.useCallback(function(e){return N.current.applyPatches(e)},[]),fe=e.useCallback(function(e){try{var t=function(){return Promise.resolve(qe([{qOp:"replace",qPath:e.qPath+"/qDef/qReverseSort",qValue:JSON.stringify(!e.qReverseSort)},{qOp:"replace",qPath:"/qHyperCubeDef/qInterColumnSortOrder",qValue:JSON.stringify([].concat(E.qHyperCube.qEffectiveInterColumnSortOrder).sort(function(t,r){return t===e.qInterColumnIndex?-1:r===e.qInterColumnIndex?1:0}))}])).then(function(){V(0)})},r=function(){if("N"===e.qSortIndicator){var t=function(){var t=function(){if(e.qPath.includes("qMeasures"))return Promise.resolve(qe([{qOp:"add",qPath:e.qPath+"/qSortBy",qValue:JSON.stringify({qSortByLoadOrder:1})}])).then(function(){})}();if(t&&t.then)return t.then(function(){})},r=function(){if(e.qPath.includes("qDimensions"))return Promise.resolve(qe([{qOp:"add",qPath:e.qPath+"/qDef/qSortCriterias",qValue:JSON.stringify([{qSortByLoadOrder:1}])}])).then(function(){})}();return r&&r.then?r.then(t):t()}}();return Promise.resolve(r&&r.then?r.then(t):t())}catch(e){return Promise.reject(e)}},[qe,E]);return e.useEffect(function(){if(w&&!N.current)try{var e=ee();return Promise.resolve(w).then(function(t){return Promise.resolve(t.createSessionObject(e)).then(function(t){N.current=t,N.current.on("changed",function(){ue(e.qHyperCubeDef.qMeasures)}),ue(e.qHyperCubeDef.qMeasures)})})}catch(e){Promise.reject(e)}},[ee,w,ue]),e.useEffect(function(){return function(){return m.current=!1}},[]),{beginSelections:ae,endSelections:ce,title:k,qLayout:E,qData:j,dataSet:I,headerGroup:O,handleSortChange:fe,qRData:T,changePage:se,selections:F,select:le,applyPatches:qe,incrementPage:function(){Y(W+1)},decrementPage:function(){Y(0==W?Q-1:W-1)},handlePageChange:Y,page:W,pageSize:H,pages:Q}},exports.useVariable=function(t){var r="string"==typeof t?t:t.name||null,n=L(ie,t),o=n.id,i=n.comment,u=n.numberPresentation,s=n.includeInBookmark,a=n.definition,c=(e.useContext(f)||{}).engine,l=e.useState(null),q=l[0],p=l[1],h=e.useState(null),m=h[0],y=h[1],b=e.useState(null),v=b[0],C=b[1],g=e.useRef(null),S=function(e,t,r,n,o,i){return{qInfo:{qId:e,qType:"Variable"},qMetaDef:{},qName:t,qComment:r,qNumberPresentation:n,qIncludeInBookmark:o,qDefinition:i.toString()}},P=e.useCallback(function(){return g.current.getLayout()},[]),D=e.useCallback(function(){return g.current.getProperties()},[]),x=e.useCallback(function(e){try{var t=e.qId,r=e.qName,n=e.qComment,o=e.qNumberPresentation,i=e.qIncludeInBookmark,u=e.qDefinition,s=function(){if(g.current)return Promise.resolve(D()).then(function(e){return Promise.resolve(g.current.setProperties(S(t||e.qInfo.qId,r||e.qName,n||e.qComment,o||e.qNumberPresentation,i||e.qIncludeInBookmark,u.toString()||e.qDefinition.toString()))).then(function(e){j(e.current)})})}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),k=e.useCallback(function(e){try{var t=function(){if(g.current)return Promise.resolve(D()).then(function(t){return Promise.resolve(g.current.setProperties(S(t.qInfo.qId,t.qName,t.qComment,t.qNumberPresentation,t.qIncludeInBookmark,e.toString()))).then(function(e){j(e.current)})})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[]),j=e.useCallback(function(e){try{return Promise.resolve(P()).then(function(e){return e.value="number"===e.qNum?e.qNum:e.qText,p(e),Promise.resolve(D()).then(function(e){y(e)})})}catch(e){return Promise.reject(e)}},[]);return e.useEffect(function(){if(c)try{return Promise.resolve(c).then(function(e){var t=oe(function(){return Promise.resolve(function(e,t,r,n,o,i){try{return Promise.resolve(c).then(function(u){function s(){function s(){function s(){var s=function(){if(t&&i){var s=oe(function(){return Promise.resolve(u.getVariableByName({qName:t})).then(function(e){a=e})},function(s){function c(){(v.code=18001)?C("Variable already exists"):C(s)}var l=function(){if(!a)return Promise.resolve(u.createSessionVariable(S(e,t,r,n,o,i))).then(function(e){return a=e,Promise.resolve(a).then(function(e){g.current=e,j(g.current)})})}();return l&&l.then?l.then(c):c()});if(s&&s.then)return s.then(function(){})}}();return s&&s.then?s.then(function(){return a}):a}var c=function(){if(t&&!i)return Promise.resolve(u.getVariableByName({qName:t})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var c=function(){if(e&&!i)return Promise.resolve(u.getVariableById({qId:e})).then(function(e){a=e})}();return c&&c.then?c.then(s):s()}var a,c=function(){if(!e&&!t&&!i)return Promise.resolve(u.createSessionObject({qInfo:{qId:"VL01",qType:"VariableList"},qVariableListDef:{qType:"variable"}})).then(function(e){return Promise.resolve(e.getLayout()).then(function(e){p(a=e)})})}();return c&&c.then?c.then(s):s()})}catch(e){return Promise.reject(e)}}(o,r,i,u,s,a)).then(function(e){g.current=e,g.current.on("changed",function(){j(g.current)}),j(g.current)})},function(e){C(-2===e.code?"Variable Not Found":e)});if(t&&t.then)return t.then(function(){})})}catch(e){Promise.reject(e)}},[o,r,c]),q&&q.qVariableList&&(q.variableList=q.qVariableList.qItems),d({qLayout:q},q,{qProperties:m,setProperties:x,setValue:k,error:v})};
//# sourceMappingURL=index.js.map
