{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar SecurityDefense = function SecurityDefense(waterMarkStyle, getImageUrl, securityAlarm) {\n  var _this = this;\n\n  _classCallCheck(this, SecurityDefense);\n\n  this.getWaterMarkDom = function () {\n    return document.getElementById(_this.randomId);\n  };\n\n  this.registerNodeRemoveListener = function (dom, parent) {\n    dom.addEventListener('DOMNodeRemoved', function () {\n      _this.createWaterMarkDom(parent);\n\n      if (_this.securityAlarm) {\n        _this.securityAlarm();\n      }\n    }, false);\n  };\n\n  this.createWaterMarkDom = function (parent) {\n    var newWaterMark = document.createElement('div');\n    _this.randomId = 'water-mark-observer-' + new Date().getTime();\n    newWaterMark.id = _this.randomId;\n    _this.waterMarkStyle = _this.waterMarkStyle.concat('background-image: url(\"' + _this.getImageUrl() + '\");');\n    newWaterMark.style = _this.waterMarkStyle;\n    parent.appendChild(newWaterMark);\n\n    var newDom = _this.getWaterMarkDom();\n\n    _this.registerNodeRemoveListener(newDom, parent);\n\n    _this.registerNodeAttrChangeListener(newDom);\n  };\n\n  this.registerNodeAttrChangeListener = function (target) {\n    var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n    var observer = new MutationObserver(function (mutations) {\n      mutations.forEach(function (mutation) {\n        if (mutation.type === 'attributes') {\n          target.parentNode.removeChild(target);\n          observer.disconnect();\n        }\n      });\n    });\n    var config = {\n      attributes: true,\n      attributeFilter: ['style']\n    };\n    observer.observe(target, config);\n  };\n\n  this.randomId = 'water-mark-observer';\n  this.waterMarkStyle = waterMarkStyle;\n  this.getImageUrl = getImageUrl;\n  this.securityAlarm = securityAlarm;\n};\n\nexports.default = SecurityDefense;\nmodule.exports = exports['default'];","map":{"version":3,"sources":["../src/SecurityDefense.js"],"names":["SecurityDefense","document","dom","newWaterMark","parent","newDom","MutationObserver","window","observer","mutations","mutation","target","config","attributes","attributeFilter"],"mappings":";;;;;;;;;;;;IAAqBA,e,GACnB,SAAA,eAAA,CAAA,cAAA,EAAA,WAAA,EAAA,aAAA,EAAwD;AAAA,MAAA,KAAA,GAAA,IAAA;;AAAA,EAAA,eAAA,CAAA,IAAA,EAAA,eAAA,CAAA;;AAAA,OAAA,eAAA,GAOtC,YAAM;AACtB,WAAOC,QAAAA,CAAAA,cAAAA,CAAwB,KAAA,CAA/B,QAAOA,CAAP;AARsD,GAAA;;AAAA,OAAA,0BAAA,GAW3B,UAAA,GAAA,EAAA,MAAA,EAAiB;AAC5CC,IAAAA,GAAAA,CAAAA,gBAAAA,CAAAA,gBAAAA,EAAuC,YAAM;AAC3C,MAAA,KAAA,CAAA,kBAAA,CAAA,MAAA;;AACA,UAAI,KAAA,CAAJ,aAAA,EAAwB;AACtB,QAAA,KAAA,CAAA,aAAA;AACD;AAJHA,KAAAA,EAAAA,KAAAA;AAZsD,GAAA;;AAAA,OAAA,kBAAA,GAoBnC,UAAA,MAAA,EAAY;AAC/B,QAAMC,YAAAA,GAAeF,QAAAA,CAAAA,aAAAA,CAArB,KAAqBA,CAArB;AACA,IAAA,KAAA,CAAA,QAAA,GAAA,yBAAwC,IAAD,IAAC,GAAxC,OAAwC,EAAxC;AACAE,IAAAA,YAAAA,CAAAA,EAAAA,GAAkB,KAAA,CAAlBA,QAAAA;AACA,IAAA,KAAA,CAAA,cAAA,GAAsB,KAAA,CAAA,cAAA,CAAA,MAAA,CAAA,4BAAqD,KAAA,CAArD,WAAqD,EAArD,GAAtB,KAAsB,CAAtB;AACAA,IAAAA,YAAAA,CAAAA,KAAAA,GAAqB,KAAA,CAArBA,cAAAA;AACAC,IAAAA,MAAAA,CAAAA,WAAAA,CAAAA,YAAAA;;AACA,QAAMC,MAAAA,GAAS,KAAA,CAAf,eAAe,EAAf;;AACA,IAAA,KAAA,CAAA,0BAAA,CAAA,MAAA,EAAA,MAAA;;AACA,IAAA,KAAA,CAAA,8BAAA,CAAA,MAAA;AA7BsD,GAAA;;AAAA,OAAA,8BAAA,GAgCvB,UAAA,MAAA,EAAY;AAC3C,QAAIC,gBAAAA,GAAmBC,MAAAA,CAAAA,gBAAAA,IAA2BA,MAAAA,CAA3BA,sBAAAA,IAA4DA,MAAAA,CAAnF,mBAAA;AACA,QAAIC,QAAAA,GAAW,IAAA,gBAAA,CAAqB,UAAA,SAAA,EAAe;AACjDC,MAAAA,SAAAA,CAAAA,OAAAA,CAAkB,UAAA,QAAA,EAAc;AAC9B,YAAIC,QAAAA,CAAAA,IAAAA,KAAJ,YAAA,EAAoC;AAClCC,UAAAA,MAAAA,CAAAA,UAAAA,CAAAA,WAAAA,CAAAA,MAAAA;AACAH,UAAAA,QAAAA,CAAAA,UAAAA;AACD;AAJHC,OAAAA;AADF,KAAe,CAAf;AAQA,QAAIG,MAAAA,GAAS;AAAEC,MAAAA,UAAAA,EAAF,IAAA;AAAoBC,MAAAA,eAAAA,EAAiB,CAAlD,OAAkD;AAArC,KAAb;AACAN,IAAAA,QAAAA,CAAAA,OAAAA,CAAAA,MAAAA,EAAAA,MAAAA;AA3CsD,GAAA;;AACtD,OAAA,QAAA,GAAA,qBAAA;AACA,OAAA,cAAA,GAAA,cAAA;AACA,OAAA,WAAA,GAAA,WAAA;AACA,OAAA,aAAA,GAAA,aAAA;;;kBALiBR,e","sourcesContent":["export default class SecurityDefense {\n  constructor(waterMarkStyle, getImageUrl, securityAlarm) {\n    this.randomId = 'water-mark-observer'\n    this.waterMarkStyle = waterMarkStyle\n    this.getImageUrl = getImageUrl\n    this.securityAlarm = securityAlarm\n  }\n\n  getWaterMarkDom = () => {\n    return document.getElementById(this.randomId)\n  }\n\n  registerNodeRemoveListener = (dom, parent) => {\n    dom.addEventListener('DOMNodeRemoved', () => {\n      this.createWaterMarkDom(parent)\n      if (this.securityAlarm) {\n        this.securityAlarm()\n      }\n    }, false)\n  }\n\n  createWaterMarkDom = (parent) => {\n    const newWaterMark = document.createElement('div')\n    this.randomId = `water-mark-observer-${(new Date()).getTime()}`\n    newWaterMark.id = this.randomId\n    this.waterMarkStyle = this.waterMarkStyle.concat(`background-image: url(\"${this.getImageUrl()}\");`)\n    newWaterMark.style = this.waterMarkStyle\n    parent.appendChild(newWaterMark)\n    const newDom = this.getWaterMarkDom()\n    this.registerNodeRemoveListener(newDom, parent)\n    this.registerNodeAttrChangeListener(newDom)\n  }\n\n  registerNodeAttrChangeListener = (target) => {\n    let MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver\n    var observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === 'attributes') {\n          target.parentNode.removeChild(target)\n          observer.disconnect()\n        }\n      })\n    })\n    let config = { attributes: true, attributeFilter: ['style'] }\n    observer.observe(target, config)\n  }\n}\n"]},"metadata":{},"sourceType":"script"}